# EPKBS 项目函数技术文档

## 重排序器配置说明

本项目采用 **Cross-Encoder + MMR 集成重排序** 策略：

### 支持的重排序器类型

- **cross_encoder**: Cross-Encoder 重排序器，使用 Qwen3-Reranker-8B 模型，权重 0.7
- **mmr**: 最大边际相关性重排序器，平衡相关性和多样性，权重 0.3

### 默认配置

- 默认重排序器类型: `['cross_encoder', 'mmr']`
- 默认使用集成重排序器，自动组合两种策略
- Cross-Encoder 权重更高(0.7)，注重准确性
- MMR 权重较低(0.3)，提供多样性

### 已移除的重排序器

- ~~ColBERTReranker~~: 简化版 ColBERT 实现已删除
- ~~GraphBasedReranker~~: 基于图的重排序器已删除

## RAG 层

### core.py

#### RAGCore.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `collection_name: str = "knowledge_base"` - 集合名称
  - `embedding_model: str = None` - 嵌入模型路径
  - `reranker_types: List[str] = None` - 重排序器类型列表，默认为 ['cross_encoder', 'mmr']
  - `enable_cache: bool = True` - 是否启用缓存
- **功能描述**: 初始化 RAG 核心管理器，设置各种组件的配置参数
- **输出**: 无（构造函数）

#### RAGCore.initialize

- **函数名称**: `initialize`
- **输入参数**: 无
- **功能描述**: 异步初始化 RAG 系统的所有组件，包括嵌入管理器、向量存储、检索器和重排序器
- **输出**: 无

#### RAGCore.\_initialize_retrievers

- **函数名称**: `_initialize_retrievers`
- **输入参数**: 无
- **功能描述**: 初始化各种检索器（向量、稀疏、全文、混合、多查询检索器）
- **输出**: 无

#### RAGCore.\_initialize_rerankers

- **函数名称**: `_initialize_rerankers`
- **输入参数**: 无
- **功能描述**: 初始化各种重排序器并创建集成重排序器
- **输出**: 无

#### RAGCore.add_documents

- **函数名称**: `add_documents`
- **输入参数**:
  - `documents: List[Document]` - 文档列表
  - `embeddings: List[List[float]] = None` - 预计算的嵌入向量
  - `batch_size: int = 100` - 批处理大小
- **功能描述**: 添加文档到 RAG 系统，包括向量数据库和各种检索索引
- **输出**: `List[int]` - 插入的文档 ID 列表

#### RAGCore.search

- **函数名称**: `search`
- **输入参数**:
  - `query: str` - 查询文本
  - `top_k: int = None` - 返回结果数量
  - `retriever_type: str = "hybrid"` - 检索器类型
  - `reranker_type: str = "ensemble"` - 重排序器类型
  - `enable_multi_query: bool = False` - 是否启用多查询检索
  - `**kwargs` - 其他参数
- **功能描述**: 执行 RAG 搜索，包括检索和重排序两个阶段
- **输出**: `List[Dict[str, Any]]` - 搜索结果列表

#### RAGCore.\_retrieve_documents

- **函数名称**: `_retrieve_documents`
- **输入参数**:
  - `query: str` - 查询文本
  - `top_k: int` - 检索数量
  - `retriever_type: str` - 检索器类型
  - `enable_multi_query: bool` - 是否启用多查询
  - `**kwargs` - 其他参数
- **功能描述**: 执行文档检索阶段，选择合适的检索器进行检索
- **输出**: `List[Dict[str, Any]]` - 检索结果列表

#### RAGCore.\_rerank_documents

- **函数名称**: `_rerank_documents`
- **输入参数**:
  - `query: str` - 查询文本
  - `documents: List[Dict[str, Any]]` - 文档列表
  - `reranker_type: str` - 重排序器类型
  - `top_k: int` - 返回数量
- **功能描述**: 执行文档重排序阶段，使用指定的重排序器对文档进行重新排序
- **输出**: `List[Dict[str, Any]]` - 重排序后的文档列表

#### RAGCore.get_context

- **函数名称**: `get_context`
- **输入参数**:
  - `query: str` - 查询文本
  - `top_k: int = None` - 检索文档数量
  - `max_context_length: int = 4000` - 最大上下文长度
  - `**kwargs` - 其他搜索参数
- **功能描述**: 获取查询的上下文，构建用于生成回答的文本上下文
- **输出**: `Tuple[str, List[Dict[str, Any]]]` - (上下文文本, 源文档列表)

#### RAGCore.get_stats

- **函数名称**: `get_stats`
- **输入参数**: 无
- **功能描述**: 获取 RAG 系统的统计信息，包括文档数量、组件状态等
- **输出**: `Dict[str, Any]` - 统计信息字典

#### RAGCore.close

- **函数名称**: `close`
- **输入参数**: 无
- **功能描述**: 关闭 RAG 系统，释放所有资源和连接
- **输出**: 无

### rerankers.py

#### BaseReranker.**init**

- **函数名称**: `__init__`
- **输入参数**: `name: str` - 重排序器名称
- **功能描述**: 重排序器基类构造函数，设置名称并记录日志
- **输出**: 无（构造函数）

#### BaseReranker.rerank

- **函数名称**: `rerank`
- **输入参数**:
  - `query: str` - 查询文本
  - `documents: List[Dict[str, Any]]` - 文档列表
  - `top_k: int = None` - 返回数量
- **功能描述**: 抽象方法，重排序文档
- **输出**: `List[Dict[str, Any]]` - 重排序后的文档列表

#### CrossEncoderReranker.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `model_name: str = None` - 模型名称
  - `device: str = None` - 设备类型
  - `name: str = "CrossEncoderReranker"` - 重排序器名称
- **功能描述**: Cross-Encoder 重排序器构造函数，设置模型配置
- **输出**: 无（构造函数）

#### CrossEncoderReranker.initialize

- **函数名称**: `initialize`
- **输入参数**: 无
- **功能描述**: 初始化 Cross-Encoder 模型，支持降级机制
- **输出**: 无

#### CrossEncoderReranker.rerank

- **函数名称**: `rerank`
- **输入参数**:
  - `query: str` - 查询文本
  - `documents: List[Dict[str, Any]]` - 文档列表
  - `top_k: int = None` - 返回数量
- **功能描述**: 使用 Cross-Encoder 模型对文档进行重排序
- **输出**: `List[Dict[str, Any]]` - 重排序后的文档列表

#### MMRReranker.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `lambda_param: float = 0.5` - 相关性 vs 多样性权衡参数
  - `name: str = "MMRReranker"` - 重排序器名称
- **功能描述**: 最大边际相关性重排序器构造函数
- **输出**: 无（构造函数）

#### MMRReranker.\_calculate_similarity_matrix

- **函数名称**: `_calculate_similarity_matrix`
- **输入参数**: `documents: List[Dict[str, Any]]` - 文档列表
- **功能描述**: 计算文档间的相似度矩阵
- **输出**: `np.ndarray` - 相似度矩阵

#### MMRReranker.\_calculate_text_similarity

- **函数名称**: `_calculate_text_similarity`
- **输入参数**:
  - `text1: str` - 第一个文本
  - `text2: str` - 第二个文本
- **功能描述**: 计算文本相似度
- **输出**: `float` - 相似度分数

#### MMRReranker.rerank

- **函数名称**: `rerank`
- **输入参数**:
  - `query: str` - 查询文本
  - `documents: List[Dict[str, Any]]` - 文档列表
  - `top_k: int = None` - 返回数量
- **功能描述**: 使用最大边际相关性算法进行重排序
- **输出**: `List[Dict[str, Any]]` - 重排序后的文档列表

#### EnsembleReranker.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `rerankers: List[BaseReranker]` - 重排序器列表
  - `weights: List[float] = None` - 权重列表
  - `name: str = "EnsembleReranker"` - 重排序器名称
- **功能描述**: 集成重排序器构造函数，组合多个重排序器
- **输出**: 无（构造函数）

#### EnsembleReranker.rerank

- **函数名称**: `rerank`
- **输入参数**:
  - `query: str` - 查询文本
  - `documents: List[Dict[str, Any]]` - 文档列表
  - `top_k: int = None` - 返回数量
- **功能描述**: 并行执行多个重排序器并合并结果
- **输出**: `List[Dict[str, Any]]` - 集成重排序后的文档列表

#### RerankerFactory.create_reranker

- **函数名称**: `create_reranker`
- **输入参数**:
  - `reranker_type: str` - 重排序器类型，支持 'cross_encoder', 'mmr'
  - `**kwargs` - 其他参数
- **功能描述**: 工厂方法，根据类型创建重排序器实例
- **输出**: `BaseReranker` - 重排序器实例

#### RerankerFactory.create_ensemble_reranker

- **函数名称**: `create_ensemble_reranker`
- **输入参数**:
  - `reranker_types: List[str]` - 重排序器类型列表，默认 ['cross_encoder', 'mmr']
  - `weights: List[float] = None` - 权重列表，默认 [0.7, 0.3]
  - `**kwargs` - 其他参数
- **功能描述**: 创建集成重排序器，自动组合多个重排序器并设置权重
- **输出**: `EnsembleReranker` - 集成重排序器实例

### retrievers.py

#### BaseRetriever.**init**

- **函数名称**: `__init__`
- **输入参数**: `name: str` - 检索器名称
- **功能描述**: 检索器基类构造函数
- **输出**: 无（构造函数）

#### BaseRetriever.retrieve

- **函数名称**: `retrieve`
- **输入参数**:
  - `query: str` - 查询文本
  - `top_k: int = 10` - 返回数量
  - `**kwargs` - 其他参数
- **功能描述**: 抽象方法，检索相关文档
- **输出**: `List[Dict[str, Any]]` - 检索结果列表

#### VectorRetriever.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `vector_store: MilvusVectorStore` - 向量存储
  - `embedding_manager: CachedEmbeddingManager` - 嵌入管理器
  - `name: str = "VectorRetriever"` - 检索器名称
- **功能描述**: 向量检索器构造函数
- **输出**: 无（构造函数）

#### VectorRetriever.retrieve

- **函数名称**: `retrieve`
- **输入参数**:
  - `query: str` - 查询文本
  - `top_k: int = 10` - 返回数量
  - `similarity_threshold: float = None` - 相似度阈值
  - `**kwargs` - 其他参数
- **功能描述**: 执行向量相似度检索
- **输出**: `List[Dict[str, Any]]` - 检索结果列表

#### SparseRetriever.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `documents: List[Document] = None` - 文档列表
  - `name: str = "SparseRetriever"` - 检索器名称
- **功能描述**: 稀疏检索器（BM25）构造函数
- **输出**: 无（构造函数）

#### SparseRetriever.\_build_index

- **函数名称**: `_build_index`
- **输入参数**: 无
- **功能描述**: 构建 BM25 索引
- **输出**: 无

#### SparseRetriever.\_tokenize

- **函数名称**: `_tokenize`
- **输入参数**: `text: str` - 待分词文本
- **功能描述**: 对文本进行中英文分词
- **输出**: `List[str]` - 分词结果列表

#### SparseRetriever.retrieve

- **函数名称**: `retrieve`
- **输入参数**:
  - `query: str` - 查询文本
  - `top_k: int = 10` - 返回数量
  - `**kwargs` - 其他参数
- **功能描述**: 执行 BM25 检索
- **输出**: `List[Dict[str, Any]]` - 检索结果列表

#### SparseRetriever.add_documents

- **函数名称**: `add_documents`
- **输入参数**: `documents: List[Document]` - 文档列表
- **功能描述**: 添加文档并重建索引
- **输出**: 无

#### FullTextRetriever.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `documents: List[Document] = None` - 文档列表
  - `name: str = "FullTextRetriever"` - 检索器名称
- **功能描述**: 全文检索器构造函数
- **输出**: 无（构造函数）

#### FullTextRetriever.retrieve

- **函数名称**: `retrieve`
- **输入参数**:
  - `query: str` - 查询文本
  - `top_k: int = 10` - 返回数量
  - `case_sensitive: bool = False` - 是否区分大小写
  - `**kwargs` - 其他参数
- **功能描述**: 执行全文搜索
- **输出**: `List[Dict[str, Any]]` - 检索结果列表

#### FullTextRetriever.add_documents

- **函数名称**: `add_documents`
- **输入参数**: `documents: List[Document]` - 文档列表
- **功能描述**: 添加文档到全文检索索引
- **输出**: 无

#### HybridRetriever.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `vector_retriever: VectorRetriever` - 向量检索器
  - `sparse_retriever: SparseRetriever` - 稀疏检索器
  - `fulltext_retriever: FullTextRetriever = None` - 全文检索器
  - `vector_weight: float = None` - 向量权重
  - `sparse_weight: float = None` - 稀疏权重
  - `fulltext_weight: float = 0.1` - 全文权重
  - `name: str = "HybridRetriever"` - 检索器名称
- **功能描述**: 混合检索器构造函数，组合多种检索方式
- **输出**: 无（构造函数）

#### HybridRetriever.retrieve

- **函数名称**: `retrieve`
- **输入参数**:
  - `query: str` - 查询文本
  - `top_k: int = 10` - 返回数量
  - `**kwargs` - 其他参数
- **功能描述**: 执行混合检索，并行调用多种检索器并合并结果
- **输出**: `List[Dict[str, Any]]` - 混合检索结果列表

#### HybridRetriever.\_combine_results

- **函数名称**: `_combine_results`
- **输入参数**:
  - `vector_results: List[Dict[str, Any]]` - 向量检索结果
  - `sparse_results: List[Dict[str, Any]]` - 稀疏检索结果
  - `fulltext_results: List[Dict[str, Any]] = None` - 全文检索结果
- **功能描述**: 合并不同检索器的结果并计算混合分数
- **输出**: `List[Dict[str, Any]]` - 合并后的结果列表

#### HybridRetriever.\_get_doc_id

- **函数名称**: `_get_doc_id`
- **输入参数**: `result: Dict[str, Any]` - 检索结果
- **功能描述**: 获取文档的唯一标识符
- **输出**: `str` - 文档 ID

#### HybridRetriever.\_normalize_score

- **函数名称**: `_normalize_score`
- **输入参数**:
  - `score: float` - 原始分数
  - `retriever_type: str` - 检索器类型
- **功能描述**: 根据检索器类型归一化分数
- **输出**: `float` - 归一化后的分数

#### MultiQueryRetriever.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `base_retriever: BaseRetriever` - 基础检索器
  - `query_generator = None` - 查询生成器
  - `name: str = "MultiQueryRetriever"` - 检索器名称
- **功能描述**: 多查询检索器构造函数
- **输出**: 无（构造函数）

#### MultiQueryRetriever.\_generate_query_variants

- **函数名称**: `_generate_query_variants`
- **输入参数**: `query: str` - 原始查询
- **功能描述**: 生成查询的多个变体
- **输出**: `List[str]` - 查询变体列表

#### MultiQueryRetriever.retrieve

- **函数名称**: `retrieve`
- **输入参数**:
  - `query: str` - 查询文本
  - `top_k: int = 10` - 返回数量
  - `**kwargs` - 其他参数
- **功能描述**: 生成查询变体并并行检索，合并结果
- **输出**: `List[Dict[str, Any]]` - 多查询检索结果列表

### vector_store.py

#### MilvusVectorStore.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `collection_name: str = "knowledge_base"` - 集合名称
  - `host: str = None` - Milvus 主机地址
  - `port: int = None` - Milvus 端口
  - `user: str = None` - 用户名
  - `password: str = None` - 密码
  - `embedding_dim: int = 384` - 嵌入维度
- **功能描述**: Milvus 向量数据库管理器构造函数
- **输出**: 无（构造函数）

#### MilvusVectorStore.connect

- **函数名称**: `connect`
- **输入参数**: 无
- **功能描述**: 连接到 Milvus 数据库并设置集合
- **输出**: 无

#### MilvusVectorStore.\_setup_collection

- **函数名称**: `_setup_collection`
- **输入参数**: 无
- **功能描述**: 设置集合，加载现有集合或创建新集合
- **输出**: 无

#### MilvusVectorStore.\_create_collection

- **函数名称**: `_create_collection`
- **输入参数**: 无
- **功能描述**: 创建新的 Milvus 集合，定义字段 schema
- **输出**: 无

#### MilvusVectorStore.\_create_index

- **函数名称**: `_create_index`
- **输入参数**: 无
- **功能描述**: 创建向量索引（HNSW）和标量字段索引
- **输出**: 无

#### MilvusVectorStore.add_documents

- **函数名称**: `add_documents`
- **输入参数**:
  - `documents: List[Document]` - 文档列表
  - `embeddings: List[np.ndarray]` - 对应的向量列表
  - `batch_size: int = 100` - 批处理大小
- **功能描述**: 批量添加文档和向量到 Milvus 数据库
- **输出**: `List[int]` - 插入的文档 ID 列表

#### MilvusVectorStore.search

- **函数名称**: `search`
- **输入参数**:
  - `query_embedding: np.ndarray` - 查询向量
  - `top_k: int = 10` - 返回结果数量
  - `search_params: Dict[str, Any] = None` - 搜索参数
  - `filter_expr: str = None` - 过滤表达式
- **功能描述**: 执行向量相似度搜索
- **输出**: `List[Dict[str, Any]]` - 搜索结果列表

#### MilvusVectorStore.hybrid_search

- **函数名称**: `hybrid_search`
- **输入参数**:
  - `query_embedding: np.ndarray` - 查询向量
  - `query_text: str` - 查询文本
  - `top_k: int = 10` - 返回结果数量
  - `vector_weight: float = 0.7` - 向量搜索权重
  - `text_weight: float = 0.3` - 文本搜索权重
- **功能描述**: 执行混合搜索（向量+文本）
- **输出**: `List[Dict[str, Any]]` - 混合搜索结果

#### MilvusVectorStore.delete_by_filter

- **函数名称**: `delete_by_filter`
- **输入参数**: `filter_expr: str` - 过滤表达式
- **功能描述**: 根据过滤条件删除文档
- **输出**: `int` - 删除的文档数量

#### MilvusVectorStore.get_collection_stats

- **函数名称**: `get_collection_stats`
- **输入参数**: 无
- **功能描述**: 获取集合统计信息
- **输出**: `Dict[str, Any]` - 统计信息字典

#### MilvusVectorStore.close

- **函数名称**: `close`
- **输入参数**: 无
- **功能描述**: 关闭 Milvus 连接并释放资源
- **输出**: 无

#### VectorStoreManager.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 向量存储管理器构造函数，支持管理多个集合
- **输出**: 无（构造函数）

#### VectorStoreManager.get_store

- **函数名称**: `get_store`
- **输入参数**:
  - `collection_name: str` - 集合名称
  - `embedding_dim: int = 384` - 嵌入维度
- **功能描述**: 获取或创建指定的向量存储实例
- **输出**: `MilvusVectorStore` - 向量存储实例

#### VectorStoreManager.close_all

- **函数名称**: `close_all`
- **输入参数**: 无
- **功能描述**: 关闭所有向量存储连接
- **输出**: 无

## Agent 层

### core.py

#### AgentCore.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `model_name: str = None` - 模型名称
  - `rag_core: RAGCore = None` - RAG 核心实例
  - `max_steps: int = 10` - 最大执行步数
  - `max_execution_time: int = 300` - 最大执行时间
  - `enable_mcp: bool = True` - 是否启用 MCP
- **功能描述**: 初始化 Agent 核心管理器，设置各种组件配置
- **输出**: 无（构造函数）

#### AgentCore.initialize

- **函数名称**: `initialize`
- **输入参数**: 无
- **功能描述**: 异步初始化 Agent 系统的所有组件，包括 LLM、工具、ReAct Agent、MCP 组件等
- **输出**: 无

#### AgentCore.chat

- **函数名称**: `chat`
- **输入参数**:
  - `message: str` - 用户消息
  - `use_rag: bool = True` - 是否使用 RAG
  - `stream: bool = False` - 是否流式响应
  - `**kwargs` - 其他参数
- **功能描述**: 与 Agent 进行对话，支持普通和流式两种模式
- **输出**: `Dict[str, Any]` - 对话结果

#### AgentCore.\_normal_chat

- **函数名称**: `_normal_chat`
- **输入参数**:
  - `message: str` - 用户消息
  - `use_rag: bool` - 是否使用 RAG
  - `**kwargs` - 其他参数
- **功能描述**: 执行普通对话模式，支持直接 LLM 对话和 ReAct Agent 模式
- **输出**: `Dict[str, Any]` - 对话结果

#### AgentCore.\_stream_chat

- **函数名称**: `_stream_chat`
- **输入参数**:
  - `message: str` - 用户消息
  - `use_rag: bool` - 是否使用 RAG
  - `**kwargs` - 其他参数
- **功能描述**: 执行流式对话模式
- **输出**: `AsyncGenerator[Dict[str, Any], None]` - 流式对话结果

#### AgentCore.\_build_conversation_prompt

- **函数名称**: `_build_conversation_prompt`
- **输入参数**: `current_message: str` - 当前消息
- **功能描述**: 构建包含对话历史的 prompt
- **输出**: `str` - 构建的 prompt

#### AgentCore.clear_conversation

- **函数名称**: `clear_conversation`
- **输入参数**: 无
- **功能描述**: 清空对话历史
- **输出**: 无

#### AgentCore.get_conversation_history

- **函数名称**: `get_conversation_history`
- **输入参数**: 无
- **功能描述**: 获取对话历史记录
- **输出**: `List[Dict[str, Any]]` - 对话历史列表

#### AgentCore.add_tool

- **函数名称**: `add_tool`
- **输入参数**: `tool` - 工具实例
- **功能描述**: 添加工具到工具管理器
- **输出**: 无

#### AgentCore.remove_tool

- **函数名称**: `remove_tool`
- **输入参数**: `tool_name: str` - 工具名称
- **功能描述**: 从工具管理器中移除工具
- **输出**: 无

#### AgentCore.list_tools

- **函数名称**: `list_tools`
- **输入参数**: 无
- **功能描述**: 列出所有可用工具
- **输出**: `List[str]` - 工具名称列表

#### AgentCore.get_system_status

- **函数名称**: `get_system_status`
- **输入参数**: 无
- **功能描述**: 获取 Agent 系统的状态信息
- **输出**: `Dict[str, Any]` - 系统状态信息

#### AgentCore.close

- **函数名称**: `close`
- **输入参数**: 无
- **功能描述**: 关闭 Agent 系统并释放资源
- **输出**: 无

#### AgentCore.parse_document_with_mcp

- **函数名称**: `parse_document_with_mcp`
- **输入参数**: `file_path: str` - 文件路径
- **功能描述**: 使用 MCP Agent 解析文档
- **输出**: `Dict[str, Any]` - 解析结果

#### AgentCore.chat_with_mcp

- **函数名称**: `chat_with_mcp`
- **输入参数**:
  - `message: str` - 用户消息
  - `use_rag: bool = True` - 是否使用 RAG
- **功能描述**: 使用 MCP Agent 进行对话
- **输出**: `Dict[str, Any]` - 对话结果

#### AgentCore.get_mcp_tools

- **函数名称**: `get_mcp_tools`
- **输入参数**: 无
- **功能描述**: 获取所有可用的 MCP 工具
- **输出**: `Dict[str, Any]` - MCP 工具信息

#### AgentCore.get_mcp_server_status

- **函数名称**: `get_mcp_server_status`
- **输入参数**: 无
- **功能描述**: 获取 MCP 服务器状态
- **输出**: `Dict[str, Any]` - 服务器状态信息

#### AgentCore.call_mcp_tool

- **函数名称**: `call_mcp_tool`
- **输入参数**:
  - `tool_key: str` - 工具键名
  - `arguments: Dict[str, Any]` - 工具参数
- **功能描述**: 直接调用 MCP 工具
- **输出**: `Dict[str, Any]` - 工具执行结果

#### AgentCore.chat_with_langgraph

- **函数名称**: `chat_with_langgraph`
- **输入参数**:
  - `message: str` - 用户消息
  - `use_rag: bool = True` - 是否使用 RAG
- **功能描述**: 使用 LangGraph Agent 进行对话
- **输出**: `Dict[str, Any]` - 对话结果

#### AgentCore.parse_document_with_langgraph

- **函数名称**: `parse_document_with_langgraph`
- **输入参数**: `file_path: str` - 文件路径
- **功能描述**: 使用 LangGraph 工作流解析文档
- **输出**: `Dict[str, Any]` - 解析结果

#### AgentCore.batch_process_documents_with_langgraph

- **函数名称**: `batch_process_documents_with_langgraph`
- **输入参数**: `file_paths: List[str]` - 文件路径列表
- **功能描述**: 使用 LangGraph 批量处理文档
- **输出**: `Dict[str, Any]` - 批处理结果

#### AgentCore.get_workflow_visualization

- **函数名称**: `get_workflow_visualization`
- **输入参数**: `workflow_type: str` - 工作流类型
- **功能描述**: 获取工作流可视化图表
- **输出**: `Optional[str]` - 可视化图表代码

#### AgentCore.get_agent_statistics

- **函数名称**: `get_agent_statistics`
- **输入参数**: 无
- **功能描述**: 获取 Agent 统计信息
- **输出**: `Dict[str, Any]` - 统计信息

#### AgentFactory.create_agent

- **函数名称**: `create_agent`
- **输入参数**:
  - `model_name: str = None` - 模型名称
  - `rag_core: RAGCore = None` - RAG 核心实例
  - `**kwargs` - 其他参数
- **功能描述**: 静态方法，创建 Agent 实例
- **输出**: `AgentCore` - Agent 实例

#### AgentFactory.create_rag_agent

- **函数名称**: `create_rag_agent`
- **输入参数**:
  - `collection_name: str = "knowledge_base"` - 集合名称
  - `model_name: str = None` - 模型名称
  - `**kwargs` - 其他参数
- **功能描述**: 静态方法，创建带 RAG 功能的 Agent
- **输出**: `AgentCore` - 带 RAG 功能的 Agent 实例

### langgraph_agent.py

#### MCPToolWrapper.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `tool_key: str` - 工具键名
  - `tool_info: Dict[str, Any]` - 工具信息
  - `mcp_client: MCPClientManager` - MCP 客户端管理器
- **功能描述**: MCP 工具的 LangChain 包装器构造函数
- **输出**: 无（构造函数）

#### MCPToolWrapper.\_run

- **函数名称**: `_run`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 同步运行工具（LangChain 要求）
- **输出**: `str` - 工具执行结果

#### MCPToolWrapper.\_arun

- **函数名称**: `_arun`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 异步运行工具
- **输出**: `str` - 工具执行结果

#### LangGraphAgent.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `llm_manager: LLMManager` - LLM 管理器
  - `mcp_client_manager: MCPClientManager` - MCP 客户端管理器
- **功能描述**: 基于 LangGraph 的智能 Agent 构造函数
- **输出**: 无（构造函数）

#### LangGraphAgent.initialize

- **函数名称**: `initialize`
- **输入参数**: 无
- **功能描述**: 初始化 LangGraph Agent，发现 MCP 工具并创建 ReAct Agent
- **输出**: 无

#### LangGraphAgent.chat

- **函数名称**: `chat`
- **输入参数**:
  - `message: str` - 用户消息
  - `use_rag: bool = True` - 是否使用 RAG
- **功能描述**: 智能对话，支持 RAG 增强模式
- **输出**: `Dict[str, Any]` - 对话结果

#### LangGraphAgent.\_run_react_agent

- **函数名称**: `_run_react_agent`
- **输入参数**: `message: str` - 用户消息
- **功能描述**: 运行 ReAct Agent 进行推理和行动
- **输出**: `Dict[str, Any]` - Agent 执行结果

#### LangGraphAgent.parse_document

- **函数名称**: `parse_document`
- **输入参数**: `file_path: str` - 文件路径
- **功能描述**: 智能文档解析，使用文档处理工作流
- **输出**: `Dict[str, Any]` - 文档解析结果

#### LangGraphAgent.batch_process_documents

- **函数名称**: `batch_process_documents`
- **输入参数**: `file_paths: List[str]` - 文件路径列表
- **功能描述**: 批量处理文档，并行执行文档解析
- **输出**: `Dict[str, Any]` - 批处理结果

#### LangGraphAgent.get_workflow_visualization

- **函数名称**: `get_workflow_visualization`
- **输入参数**: `workflow_type: str` - 工作流类型
- **功能描述**: 获取工作流可视化图表
- **输出**: `Optional[str]` - 可视化图表代码

#### LangGraphAgent.get_statistics

- **函数名称**: `get_statistics`
- **输入参数**: 无
- **功能描述**: 获取 LangGraph Agent 统计信息
- **输出**: `Dict[str, Any]` - 统计信息

### nodes.py

#### detect_document_format

- **函数名称**: `detect_document_format`
- **输入参数**: `state: DocumentProcessingState` - 文档处理状态
- **功能描述**: 检测文档格式和类型，确定处理策略
- **输出**: `DocumentProcessingState` - 更新后的状态

#### basic_document_parse

- **函数名称**: `basic_document_parse`
- **输入参数**:
  - `state: DocumentProcessingState` - 文档处理状态
  - `mcp_client: MCPClientManager` - MCP 客户端管理器
- **功能描述**: 执行基础文档解析，调用 MCP 文档解析工具
- **输出**: `DocumentProcessingState` - 更新后的状态

#### assess_parsing_quality

- **函数名称**: `assess_parsing_quality`
- **输入参数**:
  - `state: DocumentProcessingState` - 文档处理状态
  - `mcp_client: MCPClientManager` - MCP 客户端管理器
- **功能描述**: 评估解析质量，决定是否需要高级处理
- **输出**: `DocumentProcessingState` - 更新后的状态

#### advanced_document_processing

- **函数名称**: `advanced_document_processing`
- **输入参数**:
  - `state: DocumentProcessingState` - 文档处理状态
  - `mcp_client: MCPClientManager` - MCP 客户端管理器
- **功能描述**: 执行高级文档处理，包括表格提取、图像分析等
- **输出**: `DocumentProcessingState` - 更新后的状态

#### integrate_processing_results

- **函数名称**: `integrate_processing_results`
- **输入参数**: `state: DocumentProcessingState` - 文档处理状态
- **功能描述**: 整合所有处理结果，生成最终内容和元数据
- **输出**: `DocumentProcessingState` - 更新后的状态

#### agent_think

- **函数名称**: `agent_think`
- **输入参数**:
  - `state: AgentReasoningState` - Agent 推理状态
  - `llm_manager` - LLM 管理器
- **功能描述**: Agent 思考节点，生成思考过程和下一步行动
- **输出**: `AgentReasoningState` - 更新后的状态

#### agent_act

- **函数名称**: `agent_act`
- **输入参数**:
  - `state: AgentReasoningState` - Agent 推理状态
  - `mcp_client: MCPClientManager` - MCP 客户端管理器
- **功能描述**: Agent 行动节点，执行工具调用
- **输出**: `AgentReasoningState` - 更新后的状态

#### agent_observe

- **函数名称**: `agent_observe`
- **输入参数**: `state: AgentReasoningState` - Agent 推理状态
- **功能描述**: Agent 观察节点，分析执行结果并决定下一步
- **输出**: `AgentReasoningState` - 更新后的状态

#### analyze_query_intent

- **函数名称**: `analyze_query_intent`
- **输入参数**:
  - `state: RAGWorkflowState` - RAG 工作流状态
  - `mcp_client: MCPClientManager` - MCP 客户端管理器
- **功能描述**: 分析查询意图，确定检索策略
- **输出**: `RAGWorkflowState` - 更新后的状态

#### execute_retrieval

- **函数名称**: `execute_retrieval`
- **输入参数**:
  - `state: RAGWorkflowState` - RAG 工作流状态
  - `mcp_client: MCPClientManager` - MCP 客户端管理器
- **功能描述**: 执行文档检索，调用 RAG 搜索工具
- **输出**: `RAGWorkflowState` - 更新后的状态

#### generate_context

- **函数名称**: `generate_context`
- **输入参数**:
  - `state: RAGWorkflowState` - RAG 工作流状态
  - `mcp_client: MCPClientManager` - MCP 客户端管理器
- **功能描述**: 生成上下文，构建用于回答的文本上下文
- **输出**: `RAGWorkflowState` - 更新后的状态

#### error_handling

- **函数名称**: `error_handling`
- **输入参数**: `state: Dict[str, Any]` - 任意状态
- **功能描述**: 通用错误处理节点，处理重试逻辑
- **输出**: `Dict[str, Any]` - 更新后的状态

#### \_parse_agent_response

- **函数名称**: `_parse_agent_response`
- **输入参数**: `response_text: str` - Agent 响应文本
- **功能描述**: 解析 Agent 的响应，提取思考、行动和参数
- **输出**: `tuple` - (思考, 行动, 行动参数)

### llm.py

#### BaseLLMManager.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `model_name: str` - 模型名称
  - `device: str = None` - 设备类型
- **功能描述**: LLM 管理器基类构造函数
- **输出**: 无（构造函数）

#### BaseLLMManager.initialize

- **函数名称**: `initialize`
- **输入参数**: 无
- **功能描述**: 抽象方法，初始化模型
- **输出**: 无

#### BaseLLMManager.generate

- **函数名称**: `generate`
- **输入参数**:
  - `prompt: str` - 输入提示
  - `max_tokens: int = None` - 最大生成 token 数
  - `temperature: float = None` - 温度参数
  - `**kwargs` - 其他参数
- **功能描述**: 抽象方法，生成文本
- **输出**: `str` - 生成的文本

#### BaseLLMManager.chat

- **函数名称**: `chat`
- **输入参数**:
  - `messages: List[BaseMessage]` - 对话消息列表
  - `max_tokens: int = None` - 最大生成 token 数
  - `temperature: float = None` - 温度参数
  - `**kwargs` - 其他参数
- **功能描述**: 抽象方法，对话生成
- **输出**: `str` - 生成的回复

#### QwenLLMManager.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `model_name: str = None` - 模型名称
  - `device: str = None` - 设备类型
  - `load_in_8bit: bool = False` - 是否 8bit 加载
  - `load_in_4bit: bool = False` - 是否 4bit 加载
- **功能描述**: Qwen 模型管理器构造函数
- **输出**: 无（构造函数）

#### QwenLLMManager.initialize

- **函数名称**: `initialize`
- **输入参数**: 无
- **功能描述**: 初始化 Qwen 模型，支持降级机制
- **输出**: 无

#### QwenLLMManager.\_try_fallback_model

- **函数名称**: `_try_fallback_model`
- **输入参数**: 无
- **功能描述**: 尝试降级到更小的模型
- **输出**: 无

#### QwenLLMManager.generate

- **函数名称**: `generate`
- **输入参数**:
  - `prompt: str` - 输入提示
  - `max_tokens: int = None` - 最大生成 token 数
  - `temperature: float = None` - 温度参数
  - `**kwargs` - 其他参数
- **功能描述**: 生成文本响应
- **输出**: `str` - 生成的文本

#### QwenLLMManager.chat

- **函数名称**: `chat`
- **输入参数**:
  - `messages: List[BaseMessage]` - 对话消息列表
  - `max_tokens: int = None` - 最大生成 token 数
  - `temperature: float = None` - 温度参数
  - `**kwargs` - 其他参数
- **功能描述**: 对话生成，构建对话 prompt 并生成回复
- **输出**: `str` - 生成的回复

#### QwenLLMManager.\_build_chat_prompt

- **函数名称**: `_build_chat_prompt`
- **输入参数**: `messages: List[BaseMessage]` - 对话消息列表
- **功能描述**: 构建对话 prompt
- **输出**: `str` - 构建的 prompt

#### QwenLLMManager.stream_generate

- **函数名称**: `stream_generate`
- **输入参数**:
  - `prompt: str` - 输入提示
  - `max_tokens: int = None` - 最大生成 token 数
  - `temperature: float = None` - 温度参数
  - `**kwargs` - 其他参数
- **功能描述**: 流式生成文本
- **输出**: `AsyncGenerator[str, None]` - 流式文本生成器

#### QwenLLMManager.get_model_info

- **函数名称**: `get_model_info`
- **输入参数**: 无
- **功能描述**: 获取模型信息和配置
- **输出**: `Dict[str, Any]` - 模型信息

#### LangChainLLMWrapper.**init**

- **函数名称**: `__init__`
- **输入参数**: `llm_manager: BaseLLMManager` - LLM 管理器
- **功能描述**: LangChain LLM 包装器构造函数
- **输出**: 无（构造函数）

#### LangChainLLMWrapper.\_call

- **函数名称**: `_call`
- **输入参数**:
  - `prompt: str` - 输入提示
  - `stop: Optional[List[str]] = None` - 停止词列表
- **功能描述**: 同步调用（LangChain 要求）
- **输出**: `str` - 生成的文本

#### LangChainLLMWrapper.acall

- **函数名称**: `acall`
- **输入参数**:
  - `prompt: str` - 输入提示
  - `stop: Optional[List[str]] = None` - 停止词列表
- **功能描述**: 异步调用
- **输出**: `str` - 生成的文本

#### LLMFactory.create_llm

- **函数名称**: `create_llm`
- **输入参数**:
  - `model_type: str = "qwen"` - 模型类型
  - `model_name: str = None` - 模型名称
  - `**kwargs` - 其他参数
- **功能描述**: 静态方法，创建 LLM 管理器
- **输出**: `BaseLLMManager` - LLM 管理器实例

#### LLMFactory.create_langchain_llm

- **函数名称**: `create_langchain_llm`
- **输入参数**:
  - `model_type: str = "qwen"` - 模型类型
  - `model_name: str = None` - 模型名称
  - `**kwargs` - 其他参数
- **功能描述**: 静态方法，创建 LangChain 兼容的 LLM
- **输出**: `LangChainLLMWrapper` - LangChain 包装器实例

### tools.py

#### ToolResult.**init**

- **函数名称**: `__init__`
- **输入参数**: 所有字段作为参数
- **功能描述**: 工具执行结果数据模型构造函数
- **输出**: 无（构造函数）

#### BaseTool.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `name: str` - 工具名称
  - `description: str` - 工具描述
- **功能描述**: 工具基类构造函数
- **输出**: 无（构造函数）

#### BaseTool.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 抽象方法，执行工具
- **输出**: `ToolResult` - 工具执行结果

#### BaseTool.get_schema

- **函数名称**: `get_schema`
- **输入参数**: 无
- **功能描述**: 获取工具的 JSON schema
- **输出**: `Dict[str, Any]` - 工具 schema

#### BaseTool.\_get_parameters_schema

- **函数名称**: `_get_parameters_schema`
- **输入参数**: 无
- **功能描述**: 抽象方法，获取参数 schema
- **输出**: `Dict[str, Any]` - 参数 schema

#### RAGSearchTool.**init**

- **函数名称**: `__init__`
- **输入参数**: `rag_core: RAGCore` - RAG 核心实例
- **功能描述**: RAG 搜索工具构造函数
- **输出**: 无（构造函数）

#### RAGSearchTool.execute

- **函数名称**: `execute`
- **输入参数**:
  - `query: str` - 搜索查询
  - `top_k: int = 5` - 返回结果数量
  - `**kwargs` - 其他参数
- **功能描述**: 执行 RAG 搜索
- **输出**: `ToolResult` - 搜索结果

#### RAGSearchTool.\_get_parameters_schema

- **函数名称**: `_get_parameters_schema`
- **输入参数**: 无
- **功能描述**: 获取 RAG 搜索工具的参数 schema
- **输出**: `Dict[str, Any]` - 参数 schema

#### RAGContextTool.**init**

- **函数名称**: `__init__`
- **输入参数**: `rag_core: RAGCore` - RAG 核心实例
- **功能描述**: RAG 上下文获取工具构造函数
- **输出**: 无（构造函数）

#### RAGContextTool.execute

- **函数名称**: `execute`
- **输入参数**:
  - `query: str` - 查询文本
  - `max_context_length: int = 4000` - 最大上下文长度
  - `**kwargs` - 其他参数
- **功能描述**: 获取查询相关的上下文信息
- **输出**: `ToolResult` - 上下文结果

#### RAGContextTool.\_get_parameters_schema

- **函数名称**: `_get_parameters_schema`
- **输入参数**: 无
- **功能描述**: 获取 RAG 上下文工具的参数 schema
- **输出**: `Dict[str, Any]` - 参数 schema

#### TimeTool.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 时间工具构造函数
- **输出**: 无（构造函数）

#### TimeTool.execute

- **函数名称**: `execute`
- **输入参数**:
  - `format: str = "iso"` - 时间格式
  - `**kwargs` - 其他参数
- **功能描述**: 获取当前时间和日期信息
- **输出**: `ToolResult` - 时间信息

#### TimeTool.\_get_parameters_schema

- **函数名称**: `_get_parameters_schema`
- **输入参数**: 无
- **功能描述**: 获取时间工具的参数 schema
- **输出**: `Dict[str, Any]` - 参数 schema

#### CalculatorTool.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 计算器工具构造函数
- **输出**: 无（构造函数）

#### CalculatorTool.execute

- **函数名称**: `execute`
- **输入参数**:
  - `expression: str` - 数学表达式
  - `**kwargs` - 其他参数
- **功能描述**: 执行数学计算
- **输出**: `ToolResult` - 计算结果

#### CalculatorTool.\_get_parameters_schema

- **函数名称**: `_get_parameters_schema`
- **输入参数**: 无
- **功能描述**: 获取计算器工具的参数 schema
- **输出**: `Dict[str, Any]` - 参数 schema

#### ToolManager.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 工具管理器构造函数
- **输出**: 无（构造函数）

#### ToolManager.register_tool

- **函数名称**: `register_tool`
- **输入参数**: `tool: BaseTool` - 工具实例
- **功能描述**: 注册工具到管理器
- **输出**: 无

#### ToolManager.unregister_tool

- **函数名称**: `unregister_tool`
- **输入参数**: `tool_name: str` - 工具名称
- **功能描述**: 从管理器中注销工具
- **输出**: 无

#### ToolManager.get_tool

- **函数名称**: `get_tool`
- **输入参数**: `tool_name: str` - 工具名称
- **功能描述**: 获取指定工具实例
- **输出**: `Optional[BaseTool]` - 工具实例

#### ToolManager.list_tools

- **函数名称**: `list_tools`
- **输入参数**: 无
- **功能描述**: 列出所有注册的工具名称
- **输出**: `List[str]` - 工具名称列表

#### ToolManager.get_tools_schema

- **函数名称**: `get_tools_schema`
- **输入参数**: 无
- **功能描述**: 获取所有工具的 schema
- **输出**: `List[Dict[str, Any]]` - 工具 schema 列表

#### ToolManager.execute_tool

- **函数名称**: `execute_tool`
- **输入参数**:
  - `tool_name: str` - 工具名称
  - `parameters: Dict[str, Any] = None` - 工具参数
- **功能描述**: 执行指定工具
- **输出**: `ToolResult` - 工具执行结果

#### ToolManager.execute_tools_parallel

- **函数名称**: `execute_tools_parallel`
- **输入参数**: `tool_calls: List[Dict[str, Any]]` - 工具调用列表
- **功能描述**: 并行执行多个工具
- **输出**: `List[ToolResult]` - 工具执行结果列表

#### LangChainToolWrapper.**init**

- **函数名称**: `__init__`
- **输入参数**: `langchain_tool: BaseTool` - LangChain 工具实例
- **功能描述**: LangChain 工具包装器构造函数
- **输出**: 无（构造函数）

#### LangChainToolWrapper.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 执行 LangChain 工具
- **输出**: `ToolResult` - 工具执行结果

#### LangChainToolWrapper.\_get_parameters_schema

- **函数名称**: `_get_parameters_schema`
- **输入参数**: 无
- **功能描述**: 获取 LangChain 工具的参数 schema
- **输出**: `Dict[str, Any]` - 参数 schema

#### create_default_tool_manager

- **函数名称**: `create_default_tool_manager`
- **输入参数**: `rag_core: RAGCore = None` - RAG 核心实例
- **功能描述**: 创建包含默认工具的工具管理器
- **输出**: `ToolManager` - 工具管理器实例

### react_agent.py

#### AgentState

- **函数名称**: 枚举类
- **输入参数**: 无
- **功能描述**: 定义 Agent 的执行状态枚举
- **输出**: 无（枚举类）

#### ReActStep.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `step_number: int` - 步骤编号
  - `thought: str = ""` - 思考内容
  - `action: str = ""` - 行动名称
  - `action_input: Dict[str, Any] = None` - 行动参数
  - `observation: str = ""` - 观察结果
  - `state: AgentState = AgentState.THINKING` - 当前状态
- **功能描述**: ReAct 步骤数据结构构造函数
- **输出**: 无（构造函数）

#### ReActStep.to_dict

- **函数名称**: `to_dict`
- **输入参数**: 无
- **功能描述**: 将 ReAct 步骤转换为字典格式
- **输出**: `Dict[str, Any]` - 步骤信息字典

#### ReActAgent.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `llm_manager: BaseLLMManager` - LLM 管理器
  - `tool_manager: ToolManager` - 工具管理器
  - `max_steps: int = 10` - 最大步数
  - `max_execution_time: int = 300` - 最大执行时间
- **功能描述**: ReAct Agent 构造函数
- **输出**: 无（构造函数）

#### ReActAgent.\_build_system_prompt

- **函数名称**: `_build_system_prompt`
- **输入参数**: 无
- **功能描述**: 构建 ReAct Agent 的系统提示
- **输出**: `str` - 系统提示文本

#### ReActAgent.\_parse_llm_output

- **函数名称**: `_parse_llm_output`
- **输入参数**: `output: str` - LLM 输出文本
- **功能描述**: 解析 LLM 输出，提取思考、行动和参数
- **输出**: `Tuple[str, str, Dict[str, Any]]` - (思考, 行动, 行动参数)

#### ReActAgent.\_build_conversation_history

- **函数名称**: `_build_conversation_history`
- **输入参数**: `query: str` - 用户查询
- **功能描述**: 构建包含执行历史的对话记录
- **输出**: `str` - 对话历史文本

#### ReActAgent.run

- **函数名称**: `run`
- **输入参数**: `query: str` - 用户查询
- **功能描述**: 运行 ReAct Agent，执行推理和行动循环
- **输出**: `Dict[str, Any]` - 执行结果

#### ReActAgent.stream_run

- **函数名称**: `stream_run`
- **输入参数**: `query: str` - 用户查询
- **功能描述**: 流式运行 ReAct Agent，实时返回执行过程
- **输出**: `AsyncGenerator[Dict[str, Any], None]` - 流式执行结果

#### ReActAgent.get_execution_summary

- **函数名称**: `get_execution_summary`
- **输入参数**: 无
- **功能描述**: 获取 Agent 执行摘要和统计信息
- **输出**: `Dict[str, Any]` - 执行摘要

### workflows.py

#### DocumentProcessingWorkflow.**init**

- **函数名称**: `__init__`
- **输入参数**: `mcp_client_manager` - MCP 客户端管理器
- **功能描述**: 文档处理工作流构造函数
- **输出**: 无（构造函数）

#### DocumentProcessingWorkflow.\_build_workflow

- **函数名称**: `_build_workflow`
- **输入参数**: 无
- **功能描述**: 构建文档处理工作流图
- **输出**: `StateGraph` - 编译后的工作流图

#### DocumentProcessingWorkflow.\_wrap_node

- **函数名称**: `_wrap_node`
- **输入参数**: `node_func` - 节点函数
- **功能描述**: 包装节点函数，注入 MCP 客户端
- **输出**: 包装后的节点函数

#### DocumentProcessingWorkflow.\_should_use_advanced_processing

- **函数名称**: `_should_use_advanced_processing`
- **输入参数**: `state: DocumentProcessingState` - 文档处理状态
- **功能描述**: 判断是否需要高级处理
- **输出**: `str` - 路由决策

#### DocumentProcessingWorkflow.process_document

- **函数名称**: `process_document`
- **输入参数**: `file_path: str` - 文件路径
- **功能描述**: 处理文档，执行完整的文档处理工作流
- **输出**: `Dict[str, Any]` - 处理结果

#### AgentReasoningWorkflow.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `llm_manager` - LLM 管理器
  - `mcp_client_manager` - MCP 客户端管理器
- **功能描述**: Agent 推理工作流构造函数
- **输出**: 无（构造函数）

#### AgentReasoningWorkflow.\_build_workflow

- **函数名称**: `_build_workflow`
- **输入参数**: 无
- **功能描述**: 构建 Agent 推理工作流图
- **输出**: `StateGraph` - 编译后的工作流图

#### AgentReasoningWorkflow.\_wrap_think_node

- **函数名称**: `_wrap_think_node`
- **输入参数**: `state` - 推理状态
- **功能描述**: 包装思考节点
- **输出**: 更新后的状态

#### AgentReasoningWorkflow.\_wrap_act_node

- **函数名称**: `_wrap_act_node`
- **输入参数**: `state` - 推理状态
- **功能描述**: 包装行动节点
- **输出**: 更新后的状态

#### AgentReasoningWorkflow.\_route_after_thinking

- **函数名称**: `_route_after_thinking`
- **输入参数**: `state: AgentReasoningState` - 推理状态
- **功能描述**: 思考后的路由决策
- **输出**: `str` - 路由决策

#### AgentReasoningWorkflow.\_should_continue_reasoning

- **函数名称**: `_should_continue_reasoning`
- **输入参数**: `state: AgentReasoningState` - 推理状态
- **功能描述**: 判断是否继续推理
- **输出**: `str` - 路由决策

#### AgentReasoningWorkflow.reason_and_answer

- **函数名称**: `reason_and_answer`
- **输入参数**:
  - `user_query: str` - 用户查询
  - `max_iterations: int = 10` - 最大迭代次数
- **功能描述**: 推理并回答用户问题
- **输出**: `Dict[str, Any]` - 推理结果

#### RAGWorkflow.**init**

- **函数名称**: `__init__`
- **输入参数**: `mcp_client_manager` - MCP 客户端管理器
- **功能描述**: RAG 检索工作流构造函数
- **输出**: 无（构造函数）

#### RAGWorkflow.\_build_workflow

- **函数名称**: `_build_workflow`
- **输入参数**: 无
- **功能描述**: 构建 RAG 工作流图
- **输出**: `StateGraph` - 编译后的工作流图

#### RAGWorkflow.\_wrap_node

- **函数名称**: `_wrap_node`
- **输入参数**: `node_func` - 节点函数
- **功能描述**: 包装节点函数
- **输出**: 包装后的节点函数

#### RAGWorkflow.search_and_retrieve

- **函数名称**: `search_and_retrieve`
- **输入参数**:
  - `query: str` - 搜索查询
  - `top_k: int = 10` - 返回结果数量
- **功能描述**: 搜索和检索相关文档
- **输出**: `Dict[str, Any]` - 检索结果

#### WorkflowManager.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `llm_manager` - LLM 管理器
  - `mcp_client_manager` - MCP 客户端管理器
- **功能描述**: 工作流管理器构造函数
- **输出**: 无（构造函数）

#### WorkflowManager.process_document

- **函数名称**: `process_document`
- **输入参数**: `file_path: str` - 文件路径
- **功能描述**: 处理文档
- **输出**: `Dict[str, Any]` - 处理结果

#### WorkflowManager.agent_reasoning

- **函数名称**: `agent_reasoning`
- **输入参数**:
  - `query: str` - 用户查询
  - `max_iterations: int = 10` - 最大迭代次数
- **功能描述**: Agent 推理
- **输出**: `Dict[str, Any]` - 推理结果

#### WorkflowManager.rag_search

- **函数名称**: `rag_search`
- **输入参数**:
  - `query: str` - 搜索查询
  - `top_k: int = 10` - 返回结果数量
- **功能描述**: RAG 搜索
- **输出**: `Dict[str, Any]` - 搜索结果

#### WorkflowManager.visualize_workflow

- **函数名称**: `visualize_workflow`
- **输入参数**:
  - `workflow_type: str` - 工作流类型
  - `output_path: str = None` - 输出路径
- **功能描述**: 可视化工作流
- **输出**: `str` - Mermaid 图代码

#### WorkflowManager.get_workflow_stats

- **函数名称**: `get_workflow_stats`
- **输入参数**: 无
- **功能描述**: 获取工作流统计信息
- **输出**: `Dict[str, Any]` - 统计信息

### states.py

#### create_document_processing_state

- **函数名称**: `create_document_processing_state`
- **输入参数**:
  - `file_path: str` - 文件路径
  - `session_id: str = None` - 会话 ID
- **功能描述**: 创建文档处理状态
- **输出**: `DocumentProcessingState` - 文档处理状态

#### create_agent_reasoning_state

- **函数名称**: `create_agent_reasoning_state`
- **输入参数**:
  - `user_query: str` - 用户查询
  - `session_id: str = None` - 会话 ID
  - `max_iterations: int = 10` - 最大迭代次数
- **功能描述**: 创建 Agent 推理状态
- **输出**: `AgentReasoningState` - Agent 推理状态

#### create_rag_workflow_state

- **函数名称**: `create_rag_workflow_state`
- **输入参数**:
  - `query: str` - 查询文本
  - `session_id: str = None` - 会话 ID
- **功能描述**: 创建 RAG 工作流状态
- **输出**: `RAGWorkflowState` - RAG 工作流状态

## 数据处理层

### embeddings.py

#### EmbeddingManager.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `model_name: str = None` - 模型名称
  - `device: str = None` - 设备类型
- **功能描述**: 嵌入模型管理器构造函数，设置模型和设备配置
- **输出**: 无（构造函数）

#### EmbeddingManager.initialize

- **函数名称**: `initialize`
- **输入参数**: 无
- **功能描述**: 异步初始化嵌入模型，支持 CPU 降级机制
- **输出**: 无

#### EmbeddingManager.embed_documents

- **函数名称**: `embed_documents`
- **输入参数**: `documents: List[Document]` - 文档列表
- **功能描述**: 对文档列表进行向量化
- **输出**: `List[np.ndarray]` - 向量列表

#### EmbeddingManager.embed_texts

- **函数名称**: `embed_texts`
- **输入参数**: `texts: List[str]` - 文本列表
- **功能描述**: 对文本列表进行批量向量化，支持批处理优化
- **输出**: `List[np.ndarray]` - 向量列表

#### EmbeddingManager.embed_query

- **函数名称**: `embed_query`
- **输入参数**: `query: str` - 查询文本
- **功能描述**: 对单个查询文本进行向量化
- **输出**: `np.ndarray` - 查询向量

#### EmbeddingManager.get_embedding_dimension

- **函数名称**: `get_embedding_dimension`
- **输入参数**: 无
- **功能描述**: 获取嵌入向量的维度
- **输出**: `int` - 嵌入维度

#### MultiModelEmbeddingManager.**init**

- **函数名称**: `__init__`
- **输入参数**: `models: Dict[str, str] = None` - 模型映射字典
- **功能描述**: 多模型嵌入管理器构造函数，支持多种嵌入模型
- **输出**: 无（构造函数）

#### MultiModelEmbeddingManager.initialize

- **函数名称**: `initialize`
- **输入参数**: 无
- **功能描述**: 初始化所有嵌入模型
- **输出**: 无

#### MultiModelEmbeddingManager.embed_documents

- **函数名称**: `embed_documents`
- **输入参数**:
  - `documents: List[Document]` - 文档列表
  - `model_name: str = 'default'` - 模型名称
- **功能描述**: 使用指定模型对文档进行向量化
- **输出**: `List[np.ndarray]` - 向量列表

#### MultiModelEmbeddingManager.embed_texts

- **函数名称**: `embed_texts`
- **输入参数**:
  - `texts: List[str]` - 文本列表
  - `model_name: str = 'default'` - 模型名称
- **功能描述**: 使用指定模型对文本进行向量化
- **输出**: `List[np.ndarray]` - 向量列表

#### MultiModelEmbeddingManager.embed_query

- **函数名称**: `embed_query`
- **输入参数**:
  - `query: str` - 查询文本
  - `model_name: str = 'default'` - 模型名称
- **功能描述**: 使用指定模型对查询进行向量化
- **输出**: `np.ndarray` - 查询向量

#### MultiModelEmbeddingManager.get_available_models

- **函数名称**: `get_available_models`
- **输入参数**: 无
- **功能描述**: 获取可用的模型列表
- **输出**: `List[str]` - 模型名称列表

#### EmbeddingCache.**init**

- **函数名称**: `__init__`
- **输入参数**: `cache_dir: Path = None` - 缓存目录
- **功能描述**: 嵌入缓存管理器构造函数
- **输出**: 无（构造函数）

#### EmbeddingCache.get_cache_key

- **函数名称**: `get_cache_key`
- **输入参数**:
  - `text: str` - 文本内容
  - `model_name: str` - 模型名称
- **功能描述**: 生成缓存键
- **输出**: `str` - 缓存键

#### EmbeddingCache.get_embedding

- **函数名称**: `get_embedding`
- **输入参数**:
  - `text: str` - 文本内容
  - `model_name: str` - 模型名称
- **功能描述**: 从缓存获取嵌入向量
- **输出**: `Optional[np.ndarray]` - 嵌入向量或 None

#### EmbeddingCache.set_embedding

- **函数名称**: `set_embedding`
- **输入参数**:
  - `text: str` - 文本内容
  - `model_name: str` - 模型名称
  - `embedding: np.ndarray` - 嵌入向量
- **功能描述**: 设置嵌入缓存，同时保存到内存和磁盘
- **输出**: 无

#### EmbeddingCache.clear_cache

- **函数名称**: `clear_cache`
- **输入参数**: 无
- **功能描述**: 清空所有缓存（内存和磁盘）
- **输出**: 无

#### CachedEmbeddingManager.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `model_name: str = None` - 模型名称
  - `device: str = None` - 设备类型
  - `enable_cache: bool = True` - 是否启用缓存
- **功能描述**: 带缓存的嵌入管理器构造函数
- **输出**: 无（构造函数）

#### CachedEmbeddingManager.embed_texts

- **函数名称**: `embed_texts`
- **输入参数**: `texts: List[str]` - 文本列表
- **功能描述**: 带缓存的文本向量化，自动检查缓存并更新
- **输出**: `List[np.ndarray]` - 向量列表

### loaders.py

#### AdvancedDocumentLoader.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 高级文档加载器构造函数，使用新的解析器架构
- **输出**: 无（构造函数）

#### AdvancedDocumentLoader.\_initialize_parsers

- **函数名称**: `_initialize_parsers`
- **输入参数**: 无
- **功能描述**: 初始化所有解析器，注册主要和特殊解析器
- **输出**: 无

#### AdvancedDocumentLoader.load_and_process_document

- **函数名称**: `load_and_process_document`
- **输入参数**: `file_path: Union[str, Path]` - 文件路径
- **功能描述**: 加载并处理文档的完整流水线，包括验证、解析、整合、清洗和分块
- **输出**: `List[Document]` - 处理后的文档块列表

#### AdvancedDocumentLoader.\_execute_parsers

- **函数名称**: `_execute_parsers`
- **输入参数**:
  - `file_path: Path` - 文件路径
  - `doc_info` - 文档信息
- **功能描述**: 执行解析器，包括主解析器和特殊解析器
- **输出**: `List` - 解析结果列表

#### AdvancedDocumentLoader.load_documents

- **函数名称**: `load_documents`
- **输入参数**: `file_paths: List[Union[str, Path]]` - 文件路径列表
- **功能描述**: 批量加载文档
- **输出**: `List[Document]` - 所有文档的处理结果

#### DocumentLoader.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 统一文档加载器构造函数（保持向后兼容）
- **输出**: 无（构造函数）

#### DocumentLoader.load_document

- **函数名称**: `load_document`
- **输入参数**: `file_path: Union[str, Path]` - 文件路径
- **功能描述**: 加载单个文档，自动识别格式并添加元数据
- **输出**: `List[Document]` - 文档列表

#### DocumentLoader.load_documents

- **函数名称**: `load_documents`
- **输入参数**: `file_paths: List[Union[str, Path]]` - 文件路径列表
- **功能描述**: 批量加载文档
- **输出**: `List[Document]` - 文档列表

#### DocumentLoader.\_load_pdf

- **函数名称**: `_load_pdf`
- **输入参数**: `file_path: Path` - PDF 文件路径
- **功能描述**: 加载 PDF 文档
- **输出**: `List[Document]` - 文档列表

#### DocumentLoader.\_load_docx

- **函数名称**: `_load_docx`
- **输入参数**: `file_path: Path` - Word 文件路径
- **功能描述**: 加载 Word 文档
- **输出**: `List[Document]` - 文档列表

#### DocumentLoader.\_load_pptx

- **函数名称**: `_load_pptx`
- **输入参数**: `file_path: Path` - PowerPoint 文件路径
- **功能描述**: 加载 PowerPoint 文档
- **输出**: `List[Document]` - 文档列表

#### DocumentLoader.\_load_text

- **函数名称**: `_load_text`
- **输入参数**: `file_path: Path` - 文本文件路径
- **功能描述**: 加载文本文档
- **输出**: `List[Document]` - 文档列表

#### DocumentLoader.\_load_markdown

- **函数名称**: `_load_markdown`
- **输入参数**: `file_path: Path` - Markdown 文件路径
- **功能描述**: 加载 Markdown 文档
- **输出**: `List[Document]` - 文档列表

#### DocumentLoader.\_load_excel

- **函数名称**: `_load_excel`
- **输入参数**: `file_path: Path` - Excel 文件路径
- **功能描述**: 加载 Excel 文档
- **输出**: `List[Document]` - 文档列表

#### UnstructuredDocumentLoader.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 基于 Unstructured 的高级文档加载器构造函数
- **输出**: 无（构造函数）

#### UnstructuredDocumentLoader.load_document

- **函数名称**: `load_document`
- **输入参数**: `file_path: Union[str, Path]` - 文件路径
- **功能描述**: 使用 Unstructured 库加载文档，支持自动分区和表格结构推断
- **输出**: `List[Document]` - 文档列表

#### DocumentMetadataExtractor.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 文档元数据提取器构造函数
- **输出**: 无（构造函数）

#### DocumentMetadataExtractor.extract_metadata

- **函数名称**: `extract_metadata`
- **输入参数**: `document: Document` - 文档对象
- **功能描述**: 提取文档元数据，包括文本统计、语言检测和文档类型推断
- **输出**: `Dict[str, Any]` - 元数据字典

#### DocumentMetadataExtractor.\_contains_chinese

- **函数名称**: `_contains_chinese`
- **输入参数**: `text: str` - 文本内容
- **功能描述**: 检测文本是否包含中文字符
- **输出**: `bool` - 是否包含中文

#### DocumentMetadataExtractor.\_infer_document_type

- **函数名称**: `_infer_document_type`
- **输入参数**: `content: str` - 文档内容
- **功能描述**: 根据内容推断文档类型
- **输出**: `str` - 文档类型

### pipeline.py

#### DocumentProcessingPipeline.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `loader_type: str = "standard"` - 加载器类型
  - `splitter_type: str = "hybrid"` - 分割器类型
  - `embedding_model: str = None` - 嵌入模型
  - `enable_cache: bool = True` - 是否启用缓存
- **功能描述**: 文档处理管道构造函数，整合加载、分割、向量化等步骤
- **输出**: 无（构造函数）

#### DocumentProcessingPipeline.initialize

- **函数名称**: `initialize`
- **输入参数**: 无
- **功能描述**: 初始化管道组件，包括文档加载器、分割器和嵌入管理器
- **输出**: 无

#### DocumentProcessingPipeline.process_files

- **函数名称**: `process_files`
- **输入参数**:
  - `file_paths: List[Union[str, Path]]` - 文件路径列表
  - `batch_size: int = 10` - 批处理大小
- **功能描述**: 处理文件列表，完整的文档处理流水线
- **输出**: `Tuple[List[Document], List[List[float]]]` - (文档列表, 嵌入向量列表)

#### DocumentProcessingPipeline.\_process_batch

- **函数名称**: `_process_batch`
- **输入参数**: `file_paths: List[Union[str, Path]]` - 文件路径列表
- **功能描述**: 处理文件批次，包括加载、元数据提取、分割和向量化
- **输出**: `Tuple[List[Document], List[List[float]]]` - (文档列表, 嵌入向量列表)

#### DocumentProcessingPipeline.process_single_file

- **函数名称**: `process_single_file`
- **输入参数**: `file_path: Union[str, Path]` - 文件路径
- **功能描述**: 处理单个文件
- **输出**: `Tuple[List[Document], List[List[float]]]` - (文档列表, 嵌入向量列表)

#### DocumentProcessingPipeline.process_text

- **函数名称**: `process_text`
- **输入参数**:
  - `text: str` - 文本内容
  - `metadata: Dict[str, Any] = None` - 元数据
- **功能描述**: 处理纯文本，包括元数据提取、分割和向量化
- **输出**: `Tuple[List[Document], List[List[float]]]` - (文档列表, 嵌入向量列表)

#### DocumentProcessingPipeline.get_pipeline_info

- **函数名称**: `get_pipeline_info`
- **输入参数**: 无
- **功能描述**: 获取管道配置信息
- **输出**: `Dict[str, Any]` - 管道信息

#### BatchProcessor.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `pipeline: DocumentProcessingPipeline` - 文档处理管道
  - `max_concurrent: int = 5` - 最大并发数
  - `progress_callback: Optional[callable] = None` - 进度回调函数
- **功能描述**: 批处理器构造函数，用于大规模文档处理
- **输出**: 无（构造函数）

#### BatchProcessor.process_directory

- **函数名称**: `process_directory`
- **输入参数**:
  - `directory: Union[str, Path]` - 目录路径
  - `recursive: bool = True` - 是否递归处理
  - `file_patterns: List[str] = None` - 文件模式列表
- **功能描述**: 处理目录中的所有文件
- **输出**: `Tuple[List[Document], List[List[float]]]` - (文档列表, 嵌入向量列表)

#### BatchProcessor.\_collect_files

- **函数名称**: `_collect_files`
- **输入参数**:
  - `directory: Path` - 目录路径
  - `recursive: bool` - 是否递归
  - `file_patterns: List[str] = None` - 文件模式列表
- **功能描述**: 收集目录中符合条件的文件
- **输出**: `List[Path]` - 文件路径列表

#### BatchProcessor.\_process_files_concurrent

- **函数名称**: `_process_files_concurrent`
- **输入参数**: `file_paths: List[Path]` - 文件路径列表
- **功能描述**: 并发处理文件列表
- **输出**: `Tuple[List[Document], List[List[float]]]` - (文档列表, 嵌入向量列表)

### document_validator.py

#### DocumentType

- **函数名称**: 枚举类
- **输入参数**: 无
- **功能描述**: 定义支持的文档类型枚举
- **输出**: 无（枚举类）

#### DocumentInfo

- **函数名称**: 数据类
- **输入参数**: 所有字段作为参数
- **功能描述**: 文档信息数据类，包含文档的各种属性
- **输出**: 无（数据类）

#### DocumentValidator.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 文档验证器构造函数，初始化文件类型映射
- **输出**: 无（构造函数）

#### DocumentValidator.validate_file

- **函数名称**: `validate_file`
- **输入参数**: `file_path: Union[str, Path]` - 文件路径
- **功能描述**: 验证单个文件，检查存在性、大小、类型和特征
- **输出**: `DocumentInfo` - 文档信息

#### DocumentValidator.validate_files

- **函数名称**: `validate_files`
- **输入参数**: `file_paths: List[Union[str, Path]]` - 文件路径列表
- **功能描述**: 批量验证文件
- **输出**: `List[DocumentInfo]` - 文档信息列表

#### DocumentValidator.\_get_mime_type

- **函数名称**: `_get_mime_type`
- **输入参数**: `file_path: Path` - 文件路径
- **功能描述**: 获取文件 MIME 类型，优先使用 python-magic
- **输出**: `str` - MIME 类型

#### DocumentValidator.\_determine_document_type

- **函数名称**: `_determine_document_type`
- **输入参数**:
  - `file_path: Path` - 文件路径
  - `mime_type: str` - MIME 类型
- **功能描述**: 确定文档类型，优先使用 MIME 类型
- **输出**: `DocumentType` - 文档类型

#### DocumentValidator.\_is_scanned_pdf

- **函数名称**: `_is_scanned_pdf`
- **输入参数**: `file_path: Path` - PDF 文件路径
- **功能描述**: 检查 PDF 是否为扫描版
- **输出**: `bool` - 是否为扫描版

#### DocumentValidator.\_analyze_document_features

- **函数名称**: `_analyze_document_features`
- **输入参数**:
  - `file_path: Path` - 文件路径
  - `doc_type: DocumentType` - 文档类型
- **功能描述**: 分析文档特征，检测是否包含图像、表格、公式
- **输出**: `Tuple[bool, bool, bool]` - (有图像, 有表格, 有公式)

#### DocumentValidator.\_analyze_docx_features

- **函数名称**: `_analyze_docx_features`
- **输入参数**: `file_path: Path` - DOCX 文件路径
- **功能描述**: 分析 DOCX 文档特征
- **输出**: `Tuple[bool, bool, bool]` - (有图像, 有表格, 有公式)

#### DocumentValidator.\_analyze_pptx_features

- **函数名称**: `_analyze_pptx_features`
- **输入参数**: `file_path: Path` - PPTX 文件路径
- **功能描述**: 分析 PPTX 文档特征
- **输出**: `Tuple[bool, bool, bool]` - (有图像, 有表格, 有公式)

#### DocumentValidator.\_analyze_excel_features

- **函数名称**: `_analyze_excel_features`
- **输入参数**: `file_path: Path` - Excel 文件路径
- **功能描述**: 分析 Excel 文档特征
- **输出**: `Tuple[bool, bool, bool]` - (有图像, 有表格, 有公式)

#### DocumentValidator.\_analyze_pdf_features

- **函数名称**: `_analyze_pdf_features`
- **输入参数**: `file_path: Path` - PDF 文件路径
- **功能描述**: 分析 PDF 文档特征
- **输出**: `Tuple[bool, bool, bool]` - (有图像, 有表格, 有公式)

### splitters.py

#### BaseSplitter.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `chunk_size: int = None` - 分块大小
  - `chunk_overlap: int = None` - 分块重叠
- **功能描述**: 分割器基类构造函数
- **输出**: 无（构造函数）

#### BaseSplitter.split_documents

- **函数名称**: `split_documents`
- **输入参数**: `documents: List[Document]` - 文档列表
- **功能描述**: 抽象方法，分割文档
- **输出**: `List[Document]` - 分割后的文档列表

#### RecursiveSplitter.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `chunk_size: int = None` - 分块大小
  - `chunk_overlap: int = None` - 分块重叠
- **功能描述**: 递归字符分割器构造函数，设置中英文分隔符
- **输出**: 无（构造函数）

#### RecursiveSplitter.split_documents

- **函数名称**: `split_documents`
- **输入参数**: `documents: List[Document]` - 文档列表
- **功能描述**: 递归分割文档，添加分割相关元数据
- **输出**: `List[Document]` - 分割后的文档列表

#### TokenSplitter.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `chunk_size: int = None` - 分块大小
  - `chunk_overlap: int = None` - 分块重叠
  - `model_name: str = "gpt-3.5-turbo"` - 模型名称
- **功能描述**: 基于 Token 的分割器构造函数
- **输出**: 无（构造函数）

#### TokenSplitter.split_documents

- **函数名称**: `split_documents`
- **输入参数**: `documents: List[Document]` - 文档列表
- **功能描述**: 基于 Token 分割文档
- **输出**: `List[Document]` - 分割后的文档列表

#### SemanticSplitter.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `embedding_model: str = None` - 嵌入模型
  - `chunk_size: int = None` - 分块大小
- **功能描述**: 语义分割器构造函数，支持降级机制
- **输出**: 无（构造函数）

#### SemanticSplitter.split_documents

- **函数名称**: `split_documents`
- **输入参数**: `documents: List[Document]` - 文档列表
- **功能描述**: 语义分割文档，失败时降级到递归分割
- **输出**: `List[Document]` - 分割后的文档列表

#### HybridSplitter.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `chunk_size: int = None` - 分块大小
  - `chunk_overlap: int = None` - 分块重叠
- **功能描述**: 混合分割器构造函数，结合多种分割策略
- **输出**: 无（构造函数）

#### HybridSplitter.split_documents

- **函数名称**: `split_documents`
- **输入参数**: `documents: List[Document]` - 文档列表
- **功能描述**: 混合分割文档，根据文档类型和长度选择分割策略
- **输出**: `List[Document]` - 分割后的文档列表

#### ChineseSplitter.**init**

- **函数名称**: `__init__`
- **输入参数**:
  - `chunk_size: int = None` - 分块大小
  - `chunk_overlap: int = None` - 分块重叠
- **功能描述**: 中文优化分割器构造函数，使用中文特定分隔符
- **输出**: 无（构造函数）

#### ChineseSplitter.split_documents

- **函数名称**: `split_documents`
- **输入参数**: `documents: List[Document]` - 文档列表
- **功能描述**: 分割中文文档，优化中文分割效果
- **输出**: `List[Document]` - 分割后的文档列表

#### SplitterFactory.create_splitter

- **函数名称**: `create_splitter`
- **输入参数**:
  - `splitter_type: str` - 分割器类型
  - `**kwargs` - 分割器参数
- **功能描述**: 静态方法，创建指定类型的分割器
- **输出**: `BaseSplitter` - 分割器实例

## API 层

### app.py

#### lifespan

- **函数名称**: `lifespan`
- **输入参数**: `app: FastAPI` - FastAPI 应用实例
- **功能描述**: 异步上下文管理器，管理应用的生命周期，包括启动和关闭时的初始化和清理
- **输出**: 无（上下文管理器）

#### add_process_time_header

- **函数名称**: `add_process_time_header`
- **输入参数**:
  - `request: Request` - HTTP 请求对象
  - `call_next` - 下一个中间件函数
- **功能描述**: 中间件函数，添加请求处理时间头到响应中
- **输出**: `Response` - HTTP 响应对象

#### http_exception_handler

- **函数名称**: `http_exception_handler`
- **输入参数**:
  - `request: Request` - HTTP 请求对象
  - `exc: HTTPException` - HTTP 异常对象
- **功能描述**: HTTP 异常处理器，统一处理 HTTP 异常并返回格式化的错误响应
- **输出**: `JSONResponse` - JSON 格式的错误响应

#### general_exception_handler

- **函数名称**: `general_exception_handler`
- **输入参数**:
  - `request: Request` - HTTP 请求对象
  - `exc: Exception` - 通用异常对象
- **功能描述**: 通用异常处理器，处理未捕获的异常并返回 500 错误响应
- **输出**: `JSONResponse` - JSON 格式的错误响应

#### root

- **函数名称**: `root`
- **输入参数**: 无
- **功能描述**: API 根路径处理函数，返回 API 基本信息
- **输出**: `Dict[str, Any]` - API 基本信息

#### health_check

- **函数名称**: `health_check`
- **输入参数**: 无
- **功能描述**: 系统健康检查，检查数据库和 Redis 连接状态
- **输出**: `Dict[str, Any]` 或 `JSONResponse` - 健康状态信息

#### system_info

- **函数名称**: `system_info`
- **输入参数**: 无
- **功能描述**: 获取系统配置和特性信息
- **输出**: `Dict[str, Any]` - 系统信息

#### custom_openapi

- **函数名称**: `custom_openapi`
- **输入参数**: 无
- **功能描述**: 自定义 OpenAPI 文档生成，包含安全定义和详细描述
- **输出**: `Dict[str, Any]` - OpenAPI schema

#### custom_swagger_ui_html

- **函数名称**: `custom_swagger_ui_html`
- **输入参数**: 无
- **功能描述**: 自定义 Swagger UI 页面
- **输出**: `HTMLResponse` - Swagger UI HTML 页面

#### start_server

- **函数名称**: `start_server`
- **输入参数**: 无
- **功能描述**: 启动 FastAPI 服务器，配置 Uvicorn 参数
- **输出**: 无

### auth.py

#### AuthManager.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 认证管理器构造函数，初始化 JWT 配置参数
- **输出**: 无（构造函数）

#### AuthManager.verify_password

- **函数名称**: `verify_password`
- **输入参数**:
  - `plain_password: str` - 明文密码
  - `hashed_password: str` - 哈希密码
- **功能描述**: 验证明文密码与哈希密码是否匹配
- **输出**: `bool` - 验证结果

#### AuthManager.get_password_hash

- **函数名称**: `get_password_hash`
- **输入参数**: `password: str` - 明文密码
- **功能描述**: 生成密码的哈希值
- **输出**: `str` - 哈希密码

#### AuthManager.create_access_token

- **函数名称**: `create_access_token`
- **输入参数**:
  - `data: Dict[str, Any]` - 要编码的数据
  - `expires_delta: Optional[timedelta] = None` - 过期时间增量
- **功能描述**: 创建 JWT 访问令牌
- **输出**: `str` - JWT 令牌

#### AuthManager.verify_token

- **函数名称**: `verify_token`
- **输入参数**: `token: str` - JWT 令牌
- **功能描述**: 验证 JWT 令牌并解析载荷
- **输出**: `Optional[Dict[str, Any]]` - 令牌载荷或 None

#### AuthManager.authenticate_user

- **函数名称**: `authenticate_user`
- **输入参数**:
  - `db: AsyncSession` - 数据库会话
  - `username: str` - 用户名
  - `password: str` - 密码
- **功能描述**: 认证用户身份，验证用户名和密码
- **输出**: `Optional[User]` - 用户对象或 None

#### AuthManager.create_user

- **函数名称**: `create_user`
- **输入参数**:
  - `db: AsyncSession` - 数据库会话
  - `user_create: UserCreate` - 用户创建数据
- **功能描述**: 创建新用户，检查用户名和邮箱唯一性
- **输出**: `User` - 创建的用户对象

#### AuthManager.get_user_by_username

- **函数名称**: `get_user_by_username`
- **输入参数**:
  - `db: AsyncSession` - 数据库会话
  - `username: str` - 用户名
- **功能描述**: 根据用户名查询用户
- **输出**: `Optional[User]` - 用户对象或 None

#### AuthManager.get_user_by_id

- **函数名称**: `get_user_by_id`
- **输入参数**:
  - `db: AsyncSession` - 数据库会话
  - `user_id: int` - 用户 ID
- **功能描述**: 根据用户 ID 查询用户
- **输出**: `Optional[User]` - 用户对象或 None

#### get_current_user

- **函数名称**: `get_current_user`
- **输入参数**:
  - `credentials: HTTPAuthorizationCredentials` - 认证凭据
  - `db: AsyncSession` - 数据库会话
  - `cache: CacheManager` - 缓存管理器
- **功能描述**: FastAPI 依赖函数，获取当前认证用户
- **输出**: `User` - 当前用户对象

#### get_current_active_user

- **函数名称**: `get_current_active_user`
- **输入参数**: `current_user: User` - 当前用户
- **功能描述**: FastAPI 依赖函数，获取当前活跃用户
- **输出**: `User` - 活跃用户对象

#### get_current_superuser

- **函数名称**: `get_current_superuser`
- **输入参数**: `current_user: User` - 当前用户
- **功能描述**: FastAPI 依赖函数，获取当前超级用户
- **输出**: `User` - 超级用户对象

#### RateLimiter.**init**

- **函数名称**: `__init__`
- **输入参数**: `cache: CacheManager` - 缓存管理器
- **功能描述**: 速率限制器构造函数
- **输出**: 无（构造函数）

#### RateLimiter.check_rate_limit

- **函数名称**: `check_rate_limit`
- **输入参数**:
  - `key: str` - 限制键
  - `limit: int` - 限制数量
  - `window: int = 60` - 时间窗口（秒）
- **功能描述**: 检查是否超过速率限制
- **输出**: `bool` - 是否允许请求

#### RateLimiter.get_remaining_requests

- **函数名称**: `get_remaining_requests`
- **输入参数**:
  - `key: str` - 限制键
  - `limit: int` - 限制数量
- **功能描述**: 获取剩余请求数量
- **输出**: `int` - 剩余请求数

#### rate_limit_dependency

- **函数名称**: `rate_limit_dependency`
- **输入参数**:
  - `request_key: str` - 请求键
  - `limit: int = 100` - 限制数量
  - `window: int = 60` - 时间窗口
  - `cache: CacheManager` - 缓存管理器
- **功能描述**: FastAPI 依赖函数，执行速率限制检查
- **输出**: 无（依赖函数）

#### require_permission

- **函数名称**: `require_permission`
- **输入参数**: `permission: str` - 权限名称
- **功能描述**: 权限检查装饰器工厂函数
- **输出**: 装饰器函数

### database.py

#### DatabaseManager.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 数据库管理器构造函数，初始化连接属性
- **输出**: 无（构造函数）

#### DatabaseManager.initialize_sync_db

- **函数名称**: `initialize_sync_db`
- **输入参数**: 无
- **功能描述**: 初始化同步数据库连接和会话工厂
- **输出**: 无

#### DatabaseManager.initialize_async_db

- **函数名称**: `initialize_async_db`
- **输入参数**: 无
- **功能描述**: 初始化异步数据库连接和会话工厂
- **输出**: 无

#### DatabaseManager.initialize_redis

- **函数名称**: `initialize_redis`
- **输入参数**: 无
- **功能描述**: 初始化 Redis 连接并测试连通性
- **输出**: 无

#### DatabaseManager.create_tables

- **函数名称**: `create_tables`
- **输入参数**: 无
- **功能描述**: 创建数据库表结构
- **输出**: 无

#### DatabaseManager.drop_tables

- **函数名称**: `drop_tables`
- **输入参数**: 无
- **功能描述**: 删除所有数据库表
- **输出**: 无

#### DatabaseManager.get_sync_session

- **函数名称**: `get_sync_session`
- **输入参数**: 无
- **功能描述**: 获取同步数据库会话
- **输出**: `Session` - 同步数据库会话

#### DatabaseManager.get_async_session

- **函数名称**: `get_async_session`
- **输入参数**: 无
- **功能描述**: 获取异步数据库会话
- **输出**: `AsyncSession` - 异步数据库会话

#### DatabaseManager.get_session

- **函数名称**: `get_session`
- **输入参数**: 无
- **功能描述**: 获取数据库会话上下文管理器
- **输出**: `AsyncGenerator[AsyncSession, None]` - 会话上下文管理器

#### DatabaseManager.get_redis

- **函数名称**: `get_redis`
- **输入参数**: 无
- **功能描述**: 获取 Redis 客户端
- **输出**: `Optional[redis.Redis]` - Redis 客户端或 None

#### DatabaseManager.close

- **函数名称**: `close`
- **输入参数**: 无
- **功能描述**: 关闭所有数据库连接和 Redis 连接
- **输出**: 无

#### get_db

- **函数名称**: `get_db`
- **输入参数**: 无
- **功能描述**: FastAPI 依赖注入函数，获取数据库会话
- **输出**: `AsyncGenerator[AsyncSession, None]` - 数据库会话

#### get_redis

- **函数名称**: `get_redis`
- **输入参数**: 无
- **功能描述**: FastAPI 依赖注入函数，获取 Redis 客户端
- **输出**: `Optional[redis.Redis]` - Redis 客户端

#### CacheManager.**init**

- **函数名称**: `__init__`
- **输入参数**: `redis_client: Optional[redis.Redis] = None` - Redis 客户端
- **功能描述**: 缓存管理器构造函数
- **输出**: 无（构造函数）

#### CacheManager.get

- **函数名称**: `get`
- **输入参数**: `key: str` - 缓存键
- **功能描述**: 获取缓存值
- **输出**: `Optional[str]` - 缓存值或 None

#### CacheManager.set

- **函数名称**: `set`
- **输入参数**:
  - `key: str` - 缓存键
  - `value: str` - 缓存值
  - `ttl: Optional[int] = None` - 过期时间
- **功能描述**: 设置缓存值
- **输出**: `bool` - 设置是否成功

#### CacheManager.delete

- **函数名称**: `delete`
- **输入参数**: `key: str` - 缓存键
- **功能描述**: 删除缓存
- **输出**: `bool` - 删除是否成功

#### CacheManager.exists

- **函数名称**: `exists`
- **输入参数**: `key: str` - 缓存键
- **功能描述**: 检查缓存是否存在
- **输出**: `bool` - 是否存在

#### CacheManager.clear_pattern

- **函数名称**: `clear_pattern`
- **输入参数**: `pattern: str` - 匹配模式
- **功能描述**: 清除匹配模式的所有缓存
- **输出**: `int` - 清除的缓存数量

#### CacheManager.generate_key

- **函数名称**: `generate_key`
- **输入参数**:
  - `prefix: str` - 键前缀
  - `*args` - 其他参数
- **功能描述**: 生成缓存键
- **输出**: `str` - 缓存键

#### get_cache

- **函数名称**: `get_cache`
- **输入参数**: 无
- **功能描述**: FastAPI 依赖注入函数，获取缓存管理器
- **输出**: `CacheManager` - 缓存管理器

#### init_database

- **函数名称**: `init_database`
- **输入参数**: 无
- **功能描述**: 初始化数据库连接和表结构
- **输出**: 无

#### close_database

- **函数名称**: `close_database`
- **输入参数**: 无
- **功能描述**: 关闭数据库连接
- **输出**: 无

#### check_database_health

- **函数名称**: `check_database_health`
- **输入参数**: 无
- **功能描述**: 检查数据库和 Redis 健康状态
- **输出**: `dict` - 健康状态信息

## 前端层

### app.py

#### EPKBSApp.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: EPKBS 前端应用主类构造函数，初始化各种管理器和组件
- **输出**: 无（构造函数）

#### EPKBSApp.initialize_components

- **函数名称**: `initialize_components`
- **输入参数**: 无
- **功能描述**: 初始化界面组件，包括聊天、搜索、文档管理和侧边栏组件
- **输出**: 无

#### EPKBSApp.run

- **函数名称**: `run`
- **输入参数**: 无
- **功能描述**: 运行主应用，处理认证状态并根据当前页面显示相应内容
- **输出**: 无

#### EPKBSApp.\_show_login_page

- **函数名称**: `_show_login_page`
- **输入参数**: 无
- **功能描述**: 显示登录页面，包含登录表单和注册功能
- **输出**: 无

#### EPKBSApp.\_show_register_dialog

- **函数名称**: `_show_register_dialog`
- **输入参数**: 无
- **功能描述**: 显示用户注册对话框，处理注册表单验证和提交
- **输出**: 无

#### EPKBSApp.\_show_dashboard_page

- **函数名称**: `_show_dashboard_page`
- **输入参数**: 无
- **功能描述**: 显示系统仪表板页面，包含系统状态、快速操作和最近活动
- **输出**: 无

#### EPKBSApp.\_show_chat_page

- **函数名称**: `_show_chat_page`
- **输入参数**: 无
- **功能描述**: 显示智能对话页面
- **输出**: 无

#### EPKBSApp.\_show_search_page

- **函数名称**: `_show_search_page`
- **输入参数**: 无
- **功能描述**: 显示知识库搜索页面
- **输出**: 无

#### EPKBSApp.\_show_documents_page

- **函数名称**: `_show_documents_page`
- **输入参数**: 无
- **功能描述**: 显示文档管理页面
- **输出**: 无

#### main

- **函数名称**: `main`
- **输入参数**: 无
- **功能描述**: 主函数，创建并运行 EPKBS 应用
- **输出**: 无

### components/auth.py

#### AuthManager.**init**

- **函数名称**: `__init__`
- **输入参数**: `api_client: APIClient` - API 客户端实例
- **功能描述**: 认证管理器构造函数
- **输出**: 无（构造函数）

#### AuthManager.login

- **函数名称**: `login`
- **输入参数**:
  - `username: str` - 用户名
  - `password: str` - 密码
- **功能描述**: 用户登录，调用 API 并保存用户信息到会话状态
- **输出**: `Tuple[bool, str]` - (成功状态, 消息)

#### AuthManager.register

- **函数名称**: `register`
- **输入参数**:
  - `username: str` - 用户名
  - `email: str` - 邮箱
  - `password: str` - 密码
  - `full_name: Optional[str] = None` - 全名
- **功能描述**: 用户注册，调用 API 创建新用户
- **输出**: `Tuple[bool, str]` - (成功状态, 消息)

#### AuthManager.logout

- **函数名称**: `logout`
- **输入参数**: 无
- **功能描述**: 用户登出，清除会话状态和 API 令牌
- **输出**: `Tuple[bool, str]` - (成功状态, 消息)

#### AuthManager.get_current_user

- **函数名称**: `get_current_user`
- **输入参数**: 无
- **功能描述**: 获取当前用户信息
- **输出**: `Tuple[bool, Optional[Dict[str, Any]]]` - (成功状态, 用户信息)

#### AuthManager.render_login_form

- **函数名称**: `render_login_form`
- **输入参数**: 无
- **功能描述**: 渲染登录表单 UI 组件
- **输出**: `Tuple[bool, Optional[str], Optional[str]]` - (是否点击登录, 用户名, 密码)

#### AuthManager.render_register_form

- **函数名称**: `render_register_form`
- **输入参数**: 无
- **功能描述**: 渲染注册表单 UI 组件，包含输入验证
- **输出**: `Tuple[bool, Optional[Dict[str, str]]]` - (是否点击注册, 注册数据)

#### AuthManager.render_user_profile

- **函数名称**: `render_user_profile`
- **输入参数**: `user_info: Dict[str, Any]` - 用户信息
- **功能描述**: 渲染用户资料 UI 组件
- **输出**: 无

#### AuthManager.render_logout_button

- **函数名称**: `render_logout_button`
- **输入参数**: 无
- **功能描述**: 渲染登出按钮 UI 组件
- **输出**: `bool` - 是否点击登出

#### AuthManager.render_auth_status

- **函数名称**: `render_auth_status`
- **输入参数**: `user_info: Optional[Dict[str, Any]] = None` - 用户信息
- **功能描述**: 渲染认证状态 UI 组件
- **输出**: 无

#### AuthManager.validate_session

- **函数名称**: `validate_session`
- **输入参数**: 无
- **功能描述**: 验证当前会话的有效性
- **输出**: `bool` - 会话是否有效

### components/chat.py

#### ChatInterface.**init**

- **函数名称**: `__init__`
- **输入参数**: `api_client: APIClient` - API 客户端实例
- **功能描述**: 聊天界面组件构造函数
- **输出**: 无（构造函数）

#### ChatInterface.render

- **函数名称**: `render`
- **输入参数**: 无
- **功能描述**: 渲染完整的聊天界面，包括对话侧边栏和聊天区域
- **输出**: 无

#### ChatInterface.\_render_conversation_sidebar

- **函数名称**: `_render_conversation_sidebar`
- **输入参数**: 无
- **功能描述**: 渲染对话列表侧边栏，包含新建对话和对话管理功能
- **输出**: 无

#### ChatInterface.\_render_chat_area

- **函数名称**: `_render_chat_area`
- **输入参数**: 无
- **功能描述**: 渲染主聊天区域，包含设置、历史记录和输入框
- **输出**: 无

#### ChatInterface.\_render_chat_history

- **函数名称**: `_render_chat_history`
- **输入参数**: 无
- **功能描述**: 渲染聊天历史记录
- **输出**: 无

#### ChatInterface.\_render_user_message

- **函数名称**: `_render_user_message`
- **输入参数**:
  - `content: str` - 消息内容
  - `timestamp: str` - 时间戳
- **功能描述**: 渲染用户消息 UI 组件
- **输出**: 无

#### ChatInterface.\_render_assistant_message

- **函数名称**: `_render_assistant_message`
- **输入参数**: `message: Dict[str, Any]` - 助手消息数据
- **功能描述**: 渲染助手消息 UI 组件，包含执行详情
- **输出**: 无

#### ChatInterface.\_render_system_message

- **函数名称**: `_render_system_message`
- **输入参数**:
  - `content: str` - 消息内容
  - `timestamp: str` - 时间戳
- **功能描述**: 渲染系统消息 UI 组件
- **输出**: 无

#### ChatInterface.\_render_message_input

- **函数名称**: `_render_message_input`
- **输入参数**: 无
- **功能描述**: 渲染消息输入区域
- **输出**: 无

#### ChatInterface.\_send_message

- **函数名称**: `_send_message`
- **输入参数**: `message: str` - 用户消息
- **功能描述**: 发送消息到 API 并处理响应
- **输出**: 无

#### ChatInterface.\_send_message_to_api

- **函数名称**: `_send_message_to_api`
- **输入参数**: `message: str` - 用户消息
- **功能描述**: 异步发送消息到 API
- **输出**: `tuple[bool, Optional[Dict[str, Any]]]` - (成功状态, 响应数据)

#### ChatInterface.\_create_new_conversation

- **函数名称**: `_create_new_conversation`
- **输入参数**: 无
- **功能描述**: 创建新对话，清除当前状态
- **输出**: 无

#### ChatInterface.\_switch_conversation

- **函数名称**: `_switch_conversation`
- **输入参数**: `conversation_id: int` - 对话 ID
- **功能描述**: 切换到指定对话，加载历史消息
- **输出**: 无

#### ChatInterface.\_delete_conversation

- **函数名称**: `_delete_conversation`
- **输入参数**: `conversation_id: int` - 对话 ID
- **功能描述**: 删除指定对话，包含确认机制
- **输出**: 无

#### ChatInterface.render_chat_statistics

- **函数名称**: `render_chat_statistics`
- **输入参数**: 无
- **功能描述**: 渲染聊天统计信息 UI 组件
- **输出**: 无

#### ChatInterface.export_conversation

- **函数名称**: `export_conversation`
- **输入参数**: `conversation_id: Optional[int] = None` - 对话 ID
- **功能描述**: 导出对话记录为 Markdown 文件
- **输出**: 无

### utils/api_client.py

#### APIClient.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: API 客户端构造函数，初始化基础配置
- **输出**: 无（构造函数）

#### APIClient.\_get_session

- **函数名称**: `_get_session`
- **输入参数**: 无
- **功能描述**: 获取或创建 HTTP 会话
- **输出**: `aiohttp.ClientSession` - HTTP 会话

#### APIClient.\_get_headers

- **函数名称**: `_get_headers`
- **输入参数**: 无
- **功能描述**: 生成请求头，包含认证信息
- **输出**: `Dict[str, str]` - 请求头字典

#### APIClient.\_make_request

- **函数名称**: `_make_request`
- **输入参数**:
  - `method: str` - HTTP 方法
  - `endpoint: str` - API 端点
  - `data: Optional[Dict[str, Any]] = None` - 请求数据
  - `params: Optional[Dict[str, Any]] = None` - 查询参数
- **功能描述**: 发送 HTTP 请求的通用方法
- **输出**: `Tuple[bool, Dict[str, Any]]` - (成功状态, 响应数据)

#### APIClient.set_access_token

- **函数名称**: `set_access_token`
- **输入参数**: `token: str` - 访问令牌
- **功能描述**: 设置访问令牌用于认证
- **输出**: 无

#### APIClient.clear_access_token

- **函数名称**: `clear_access_token`
- **输入参数**: 无
- **功能描述**: 清除访问令牌
- **输出**: 无

#### APIClient.register

- **函数名称**: `register`
- **输入参数**:
  - `username: str` - 用户名
  - `email: str` - 邮箱
  - `password: str` - 密码
  - `full_name: Optional[str] = None` - 全名
- **功能描述**: 用户注册 API 调用
- **输出**: `Tuple[bool, str]` - (成功状态, 消息)

#### APIClient.login

- **函数名称**: `login`
- **输入参数**:
  - `username: str` - 用户名
  - `password: str` - 密码
- **功能描述**: 用户登录 API 调用
- **输出**: `Tuple[bool, str, Optional[Dict[str, Any]]]` - (成功状态, 消息, 用户信息)

#### APIClient.get_current_user

- **函数名称**: `get_current_user`
- **输入参数**: 无
- **功能描述**: 获取当前用户信息 API 调用
- **输出**: `Tuple[bool, Optional[Dict[str, Any]]]` - (成功状态, 用户信息)

#### APIClient.logout

- **函数名称**: `logout`
- **输入参数**: 无
- **功能描述**: 用户登出 API 调用
- **输出**: `Tuple[bool, str]` - (成功状态, 消息)

#### APIClient.create_conversation

- **函数名称**: `create_conversation`
- **输入参数**:
  - `title: Optional[str] = None` - 对话标题
  - `use_rag: bool = True` - 是否使用 RAG
  - `max_tokens: int = 1000` - 最大令牌数
  - `temperature: float = 0.7` - 温度参数
- **功能描述**: 创建对话 API 调用
- **输出**: `Tuple[bool, Optional[Dict[str, Any]]]` - (成功状态, 对话信息)

#### APIClient.get_conversations

- **函数名称**: `get_conversations`
- **输入参数**:
  - `skip: int = 0` - 跳过数量
  - `limit: int = 20` - 限制数量
- **功能描述**: 获取对话列表 API 调用
- **输出**: `Tuple[bool, List[Dict[str, Any]]]` - (成功状态, 对话列表)

#### APIClient.get_conversation_messages

- **函数名称**: `get_conversation_messages`
- **输入参数**:
  - `conversation_id: int` - 对话 ID
  - `skip: int = 0` - 跳过数量
  - `limit: int = 50` - 限制数量
- **功能描述**: 获取对话消息 API 调用
- **输出**: `Tuple[bool, List[Dict[str, Any]]]` - (成功状态, 消息列表)

#### APIClient.send_message

- **函数名称**: `send_message`
- **输入参数**:
  - `message: str` - 消息内容
  - `conversation_id: Optional[int] = None` - 对话 ID
  - `use_rag: bool = True` - 是否使用 RAG
  - `max_tokens: int = 1000` - 最大令牌数
  - `temperature: float = 0.7` - 温度参数
- **功能描述**: 发送消息 API 调用
- **输出**: `Tuple[bool, Optional[Dict[str, Any]]]` - (成功状态, 响应数据)

#### APIClient.delete_conversation

- **函数名称**: `delete_conversation`
- **输入参数**: `conversation_id: int` - 对话 ID
- **功能描述**: 删除对话 API 调用
- **输出**: `Tuple[bool, str]` - (成功状态, 消息)

#### APIClient.search_knowledge_base

- **函数名称**: `search_knowledge_base`
- **输入参数**:
  - `query: str` - 搜索查询
  - `top_k: int = 10` - 返回数量
  - `retriever_type: str = "hybrid"` - 检索器类型
  - `reranker_type: str = "ensemble"` - 重排序器类型
- **功能描述**: 搜索知识库 API 调用
- **输出**: `Tuple[bool, Optional[Dict[str, Any]]]` - (成功状态, 搜索结果)

#### APIClient.get_search_history

- **函数名称**: `get_search_history`
- **输入参数**:
  - `skip: int = 0` - 跳过数量
  - `limit: int = 20` - 限制数量
- **功能描述**: 获取搜索历史 API 调用
- **输出**: `Tuple[bool, List[Dict[str, Any]]]` - (成功状态, 搜索历史)

#### APIClient.get_search_suggestions

- **函数名称**: `get_search_suggestions`
- **输入参数**:
  - `query: str` - 查询文本
  - `limit: int = 5` - 限制数量
- **功能描述**: 获取搜索建议 API 调用
- **输出**: `Tuple[bool, List[str]]` - (成功状态, 建议列表)

#### APIClient.get_health_status

- **函数名称**: `get_health_status`
- **输入参数**: 无
- **功能描述**: 获取系统健康状态 API 调用
- **输出**: `Tuple[bool, Dict[str, Any]]` - (成功状态, 健康状态)

#### APIClient.get_system_info

- **函数名称**: `get_system_info`
- **输入参数**: 无
- **功能描述**: 获取系统信息 API 调用
- **输出**: `Tuple[bool, Dict[str, Any]]` - (成功状态, 系统信息)

#### APIClient.close

- **函数名称**: `close`
- **输入参数**: 无
- **功能描述**: 关闭 API 客户端，清理资源
- **输出**: 无

## MCP 层

### server_manager.py

#### MCPServerManager.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: MCP 服务器管理器构造函数，初始化服务器字典和统计信息
- **输出**: 无（构造函数）

#### MCPServerManager.register_server

- **函数名称**: `register_server`
- **输入参数**: `server: MCPServer` - MCP 服务器实例
- **功能描述**: 注册 MCP 服务器到管理器中
- **输出**: `bool` - 注册是否成功

#### MCPServerManager.start_server

- **函数名称**: `start_server`
- **输入参数**: `server_name: str` - 服务器名称
- **功能描述**: 启动指定的 MCP 服务器
- **输出**: `bool` - 启动是否成功

#### MCPServerManager.stop_server

- **函数名称**: `stop_server`
- **输入参数**: `server_name: str` - 服务器名称
- **功能描述**: 停止指定的 MCP 服务器
- **输出**: `bool` - 停止是否成功

#### MCPServerManager.start_all_servers

- **函数名称**: `start_all_servers`
- **输入参数**: `rag_core=None` - RAG 核心实例
- **功能描述**: 启动所有 MCP 服务器，包括 RAG、文档解析和表格提取服务器
- **输出**: `Dict[str, bool]` - 各服务器启动结果

#### MCPServerManager.stop_all_servers

- **函数名称**: `stop_all_servers`
- **输入参数**: 无
- **功能描述**: 停止所有 MCP 服务器
- **输出**: `Dict[str, bool]` - 各服务器停止结果

#### MCPServerManager.call_tool

- **函数名称**: `call_tool`
- **输入参数**:
  - `server_name: str` - 服务器名称
  - `tool_name: str` - 工具名称
  - `arguments: Dict[str, Any]` - 工具参数
- **功能描述**: 调用指定服务器的工具，并记录统计信息
- **输出**: `Dict[str, Any]` - 工具执行结果

#### MCPServerManager.list_all_tools

- **函数名称**: `list_all_tools`
- **输入参数**: 无
- **功能描述**: 列出所有服务器的工具列表
- **输出**: `Dict[str, List[Dict[str, Any]]]` - 所有工具信息

#### MCPServerManager.get_server_info

- **函数名称**: `get_server_info`
- **输入参数**: `server_name: str` - 服务器名称
- **功能描述**: 获取指定服务器的详细信息
- **输出**: `Optional[Dict[str, Any]]` - 服务器信息或 None

#### MCPServerManager.get_all_servers_info

- **函数名称**: `get_all_servers_info`
- **输入参数**: 无
- **功能描述**: 获取所有服务器的信息和管理器状态
- **输出**: `Dict[str, Any]` - 所有服务器信息

#### MCPServerManager.health_check

- **函数名称**: `health_check`
- **输入参数**: 无
- **功能描述**: 执行整体健康检查，评估所有服务器状态
- **输出**: `Dict[str, Any]` - 健康检查结果

#### MCPServerManager.get_statistics

- **函数名称**: `get_statistics`
- **输入参数**: 无
- **功能描述**: 获取管理器统计信息，包括调用次数、错误率等
- **输出**: `Dict[str, Any]` - 统计信息

### clients/mcp_client.py

#### LocalMCPClient.**init**

- **函数名称**: `__init__`
- **输入参数**: `server_manager: MCPServerManager` - 服务器管理器实例
- **功能描述**: 本地 MCP 客户端构造函数
- **输出**: 无（构造函数）

#### LocalMCPClient.connect_to_server

- **函数名称**: `connect_to_server`
- **输入参数**:
  - `server_name: str` - 服务器名称
  - `connection_info: str = "local"` - 连接信息
- **功能描述**: 连接到本地 MCP 服务器
- **输出**: 无

#### LocalMCPClient.call_tool

- **函数名称**: `call_tool`
- **输入参数**:
  - `server_name: str` - 服务器名称
  - `tool_name: str` - 工具名称
  - `arguments: Dict[str, Any]` - 工具参数
- **功能描述**: 调用远程工具并记录调用历史
- **输出**: `Dict[str, Any]` - 工具执行结果

#### LocalMCPClient.list_tools

- **函数名称**: `list_tools`
- **输入参数**: `server_name: str` - 服务器名称
- **功能描述**: 列出服务器的所有工具
- **输出**: `List[Dict[str, Any]]` - 工具列表

#### LocalMCPClient.list_all_tools

- **函数名称**: `list_all_tools`
- **输入参数**: 无
- **功能描述**: 列出所有连接服务器的工具
- **输出**: `Dict[str, List[Dict[str, Any]]]` - 所有工具列表

#### LocalMCPClient.discover_tools

- **函数名称**: `discover_tools`
- **输入参数**: 无
- **功能描述**: 发现所有可用工具，返回工具键和详细信息
- **输出**: `Dict[str, Dict[str, Any]]` - 可用工具字典

#### LocalMCPClient.batch_call_tools

- **函数名称**: `batch_call_tools`
- **输入参数**: `calls: List[Dict[str, Any]]` - 工具调用列表
- **功能描述**: 批量并行调用工具
- **输出**: `List[Dict[str, Any]]` - 批量执行结果

#### LocalMCPClient.get_call_history

- **函数名称**: `get_call_history`
- **输入参数**: `limit: int = 50` - 限制数量
- **功能描述**: 获取调用历史记录
- **输出**: `List[Dict[str, Any]]` - 调用历史

#### LocalMCPClient.get_statistics

- **函数名称**: `get_statistics`
- **输入参数**: 无
- **功能描述**: 获取客户端统计信息，包括成功率、执行时间等
- **输出**: `Dict[str, Any]` - 统计信息

#### MCPClientManager.**init**

- **函数名称**: `__init__`
- **输入参数**: `server_manager: MCPServerManager` - 服务器管理器
- **功能描述**: MCP 客户端管理器构造函数
- **输出**: 无（构造函数）

#### MCPClientManager.initialize

- **函数名称**: `initialize`
- **输入参数**: 无
- **功能描述**: 初始化客户端，连接到所有可用服务器
- **输出**: 无

#### MCPClientManager.call_tool

- **函数名称**: `call_tool`
- **输入参数**:
  - `tool_key: str` - 工具键（server.tool 格式）
  - `arguments: Dict[str, Any]` - 工具参数
- **功能描述**: 使用工具键调用工具
- **输出**: `Dict[str, Any]` - 执行结果

#### MCPClientManager.get_available_tools

- **函数名称**: `get_available_tools`
- **输入参数**: 无
- **功能描述**: 获取所有可用工具
- **输出**: `Dict[str, Dict[str, Any]]` - 可用工具字典

#### MCPClientManager.get_client_statistics

- **函数名称**: `get_client_statistics`
- **输入参数**: 无
- **功能描述**: 获取客户端统计信息
- **输出**: `Dict[str, Any]` - 统计信息

### servers/document_parsing_server.py

#### UnstructuredParseTool.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: Unstructured 通用解析工具构造函数
- **输出**: 无（构造函数）

#### UnstructuredParseTool.\_build_schema

- **函数名称**: `_build_schema`
- **输入参数**: 无
- **功能描述**: 构建工具的参数模式
- **输出**: `ToolSchema` - 工具模式

#### UnstructuredParseTool.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 执行文档解析，使用 Unstructured 库解析各种格式文档
- **输出**: `Dict[str, Any]` - 解析结果

#### UnstructuredParseTool.\_parse_with_unstructured

- **函数名称**: `_parse_with_unstructured`
- **输入参数**:
  - `file_path: str` - 文件路径
  - `strategy: str` - 解析策略
  - `extract_images: bool` - 是否提取图像
  - `chunking_strategy: str` - 分块策略
- **功能描述**: 使用 Unstructured 库解析文档
- **输出**: `List[Any]` - 解析元素列表

#### UnstructuredParseTool.\_analyze_elements

- **函数名称**: `_analyze_elements`
- **输入参数**: `elements: List[Any]` - 解析元素列表
- **功能描述**: 分析解析出的元素，检测表格、图像、公式等
- **输出**: `Dict[str, Any]` - 分析结果

#### UnstructuredParseTool.\_contains_formula

- **函数名称**: `_contains_formula`
- **输入参数**: `text: str` - 文本内容
- **功能描述**: 检测文本是否包含数学公式
- **输出**: `bool` - 是否包含公式

#### UnstructuredParseTool.\_calculate_quality_score

- **函数名称**: `_calculate_quality_score`
- **输入参数**: `elements: List[Any]` - 解析元素列表
- **功能描述**: 计算解析质量分数
- **输出**: `float` - 质量分数

#### UnstructuredParseTool.\_generate_recommendations

- **函数名称**: `_generate_recommendations`
- **输入参数**: `analysis: Dict[str, Any]` - 分析结果
- **功能描述**: 基于分析结果生成处理建议
- **输出**: `List[str]` - 建议列表

#### UnstructuredParseTool.\_element_to_dict

- **函数名称**: `_element_to_dict`
- **输入参数**: `element: Any` - 解析元素
- **功能描述**: 将元素转换为字典格式
- **输出**: `Dict[str, Any]` - 元素字典

#### DocumentStructureAnalysisTool.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 文档结构分析工具构造函数
- **输出**: 无（构造函数）

#### DocumentStructureAnalysisTool.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 分析文档结构，为后续处理提供指导
- **输出**: `Dict[str, Any]` - 结构分析结果

#### DocumentStructureAnalysisTool.\_analyze_structure

- **函数名称**: `_analyze_structure`
- **输入参数**: `file_path: str` - 文件路径
- **功能描述**: 分析文档结构的具体实现
- **输出**: `Dict[str, Any]` - 结构信息

#### DocumentParsingMCPServer.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 文档解析 MCP 服务器构造函数
- **输出**: 无（构造函数）

#### DocumentParsingMCPServer.\_register_tools

- **函数名称**: `_register_tools`
- **输入参数**: 无
- **功能描述**: 注册所有文档解析工具
- **输出**: 无

#### DocumentParsingMCPServer.start

- **函数名称**: `start`
- **输入参数**: 无
- **功能描述**: 启动文档解析 MCP 服务器
- **输出**: 无

#### DocumentParsingMCPServer.stop

- **函数名称**: `stop`
- **输入参数**: 无
- **功能描述**: 停止文档解析 MCP 服务器
- **输出**: 无

### servers/rag_server.py

#### RAGSearchTool.**init**

- **函数名称**: `__init__`
- **输入参数**: `rag_core: RAGCore` - RAG 核心实例
- **功能描述**: RAG 搜索工具构造函数
- **输出**: 无（构造函数）

#### RAGSearchTool.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 执行 RAG 搜索，支持混合检索和智能重排序
- **输出**: `Dict[str, Any]` - 搜索结果

#### RAGContextTool.**init**

- **函数名称**: `__init__`
- **输入参数**: `rag_core: RAGCore` - RAG 核心实例
- **功能描述**: RAG 上下文获取工具构造函数
- **输出**: 无（构造函数）

#### RAGContextTool.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 获取查询相关的上下文信息，用于 LLM 生成
- **输出**: `Dict[str, Any]` - 上下文结果

#### RAGAnalysisTool.**init**

- **函数名称**: `__init__`
- **输入参数**: `rag_core: RAGCore` - RAG 核心实例
- **功能描述**: RAG 查询分析工具构造函数
- **输出**: 无（构造函数）

#### RAGAnalysisTool.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 分析查询意图和复杂度，为检索策略提供建议
- **输出**: `Dict[str, Any]` - 查询分析结果

#### RAGAnalysisTool.\_analyze_query

- **函数名称**: `_analyze_query`
- **输入参数**: `query: str` - 查询文本
- **功能描述**: 分析查询的具体逻辑，包括意图、复杂度和策略建议
- **输出**: `Dict[str, Any]` - 分析结果

#### RAGStatsTool.**init**

- **函数名称**: `__init__`
- **输入参数**: `rag_core: RAGCore` - RAG 核心实例
- **功能描述**: RAG 统计信息工具构造函数
- **输出**: 无（构造函数）

#### RAGStatsTool.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 获取检索系统的统计信息和状态
- **输出**: `Dict[str, Any]` - 统计信息

#### RAGMCPServer.**init**

- **函数名称**: `__init__`
- **输入参数**: `rag_core: RAGCore` - RAG 核心实例
- **功能描述**: RAG 功能的 MCP 服务器构造函数
- **输出**: 无（构造函数）

#### RAGMCPServer.\_register_tools

- **函数名称**: `_register_tools`
- **输入参数**: 无
- **功能描述**: 注册所有 RAG 工具
- **输出**: 无

#### RAGMCPServer.start

- **函数名称**: `start`
- **输入参数**: 无
- **功能描述**: 启动 RAG MCP 服务器
- **输出**: 无

#### RAGMCPServer.stop

- **函数名称**: `stop`
- **输入参数**: 无
- **功能描述**: 停止 RAG MCP 服务器
- **输出**: 无

#### RAGMCPServer.health_check

- **函数名称**: `health_check`
- **输入参数**: 无
- **功能描述**: RAG 服务器健康检查
- **输出**: `Dict[str, Any]` - 健康状态

#### RAGMCPServer.\_check_rag_health

- **函数名称**: `_check_rag_health`
- **输入参数**: 无
- **功能描述**: 检查 RAG 核心健康状态
- **输出**: `bool` - 是否健康

### servers/table_extraction_server.py

#### CamelotTableTool.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: Camelot 表格提取工具构造函数
- **输出**: 无（构造函数）

#### CamelotTableTool.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 使用 Camelot 提取 PDF 表格，适合结构化表格
- **输出**: `Dict[str, Any]` - 表格提取结果

#### CamelotTableTool.\_extract_with_camelot

- **函数名称**: `_extract_with_camelot`
- **输入参数**:
  - `file_path: str` - 文件路径
  - `pages: str` - 页面范围
  - `flavor: str` - 检测算法
  - `table_areas: Optional[str]` - 表格区域
- **功能描述**: 使用 Camelot 提取表格的具体实现
- **输出**: `List[Any]` - 提取的表格列表

#### CamelotTableTool.\_assess_quality

- **函数名称**: `_assess_quality`
- **输入参数**: `tables: List[Dict[str, Any]]` - 表格列表
- **功能描述**: 评估表格提取质量
- **输出**: `Dict[str, Any]` - 质量评估结果

#### PDFPlumberTableTool.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: PDFPlumber 表格提取工具构造函数
- **输出**: 无（构造函数）

#### PDFPlumberTableTool.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 使用 PDFPlumber 提取 PDF 表格，适合简单表格
- **输出**: `Dict[str, Any]` - 表格提取结果

#### PDFPlumberTableTool.\_extract_with_pdfplumber

- **函数名称**: `_extract_with_pdfplumber`
- **输入参数**:
  - `file_path: str` - 文件路径
  - `page_numbers: str` - 页面编号
- **功能描述**: 使用 PDFPlumber 提取表格的具体实现
- **输出**: `List[Dict[str, Any]]` - 提取的表格列表

#### TableComparisonTool.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 表格提取方法比较工具构造函数
- **输出**: 无（构造函数）

#### TableComparisonTool.execute

- **函数名称**: `execute`
- **输入参数**: `**kwargs` - 工具参数
- **功能描述**: 比较不同表格提取方法的效果，选择最佳方案
- **输出**: `Dict[str, Any]` - 比较结果

#### TableComparisonTool.\_analyze_comparison

- **函数名称**: `_analyze_comparison`
- **输入参数**: `results: Dict[str, Any]` - 比较结果
- **功能描述**: 分析比较结果，推荐最佳方法
- **输出**: `Dict[str, Any]` - 分析结果

#### TableExtractionMCPServer.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 表格提取 MCP 服务器构造函数
- **输出**: 无（构造函数）

#### TableExtractionMCPServer.\_register_tools

- **函数名称**: `_register_tools`
- **输入参数**: 无
- **功能描述**: 注册所有表格提取工具
- **输出**: 无

#### TableExtractionMCPServer.start

- **函数名称**: `start`
- **输入参数**: 无
- **功能描述**: 启动表格提取 MCP 服务器
- **输出**: 无

#### TableExtractionMCPServer.stop

- **函数名称**: `stop`
- **输入参数**: 无
- **功能描述**: 停止表格提取 MCP 服务器
- **输出**: 无

## 工具层

### helpers.py

#### TimestampMixin.**init**

- **函数名称**: `__init__`
- **输入参数**: `**data` - 数据字典
- **功能描述**: 时间戳混入类构造函数，自动设置创建和更新时间
- **输出**: 无（构造函数）

#### generate_hash

- **函数名称**: `generate_hash`
- **输入参数**:
  - `content: str` - 内容字符串
  - `algorithm: str = "md5"` - 哈希算法
- **功能描述**: 生成内容的哈希值
- **输出**: `str` - 哈希值

#### safe_json_loads

- **函数名称**: `safe_json_loads`
- **输入参数**:
  - `json_str: str` - JSON 字符串
  - `default: Any = None` - 默认值
- **功能描述**: 安全的 JSON 解析，失败时返回默认值
- **输出**: `Any` - 解析结果或默认值

#### safe_json_dumps

- **函数名称**: `safe_json_dumps`
- **输入参数**:
  - `obj: Any` - 要序列化的对象
  - `default: str = "{}"` - 默认值
- **功能描述**: 安全的 JSON 序列化，失败时返回默认值
- **输出**: `str` - JSON 字符串或默认值

#### get_file_extension

- **函数名称**: `get_file_extension`
- **输入参数**: `filename: str` - 文件名
- **功能描述**: 获取文件扩展名（小写）
- **输出**: `str` - 文件扩展名

#### is_allowed_file

- **函数名称**: `is_allowed_file`
- **输入参数**:
  - `filename: str` - 文件名
  - `allowed_extensions: List[str]` - 允许的扩展名列表
- **功能描述**: 检查文件扩展名是否在允许列表中
- **输出**: `bool` - 是否允许

#### format_file_size

- **函数名称**: `format_file_size`
- **输入参数**: `size_bytes: int` - 字节大小
- **功能描述**: 格式化文件大小为人类可读格式
- **输出**: `str` - 格式化的大小字符串

#### read_file_async

- **函数名称**: `read_file_async`
- **输入参数**: `file_path: Union[str, Path]` - 文件路径
- **功能描述**: 异步读取文件内容
- **输出**: `str` - 文件内容

#### write_file_async

- **函数名称**: `write_file_async`
- **输入参数**:
  - `file_path: Union[str, Path]` - 文件路径
  - `content: str` - 文件内容
- **功能描述**: 异步写入文件内容，自动创建目录
- **输出**: 无

#### chunk_list

- **函数名称**: `chunk_list`
- **输入参数**:
  - `lst: List[Any]` - 要分块的列表
  - `chunk_size: int` - 分块大小
- **功能描述**: 将列表分成指定大小的块
- **输出**: `List[List[Any]]` - 分块后的列表

#### merge_dicts

- **函数名称**: `merge_dicts`
- **输入参数**: `*dicts: Dict[str, Any]` - 要合并的字典
- **功能描述**: 合并多个字典
- **输出**: `Dict[str, Any]` - 合并后的字典

#### calculate_similarity

- **函数名称**: `calculate_similarity`
- **输入参数**:
  - `text1: str` - 第一个文本
  - `text2: str` - 第二个文本
- **功能描述**: 计算两个文本的简单相似度（基于字符集合）
- **输出**: `float` - 相似度分数

#### Timer.**init**

- **函数名称**: `__init__`
- **输入参数**: 无
- **功能描述**: 计时器工具类构造函数
- **输出**: 无（构造函数）

#### Timer.start

- **函数名称**: `start`
- **输入参数**: 无
- **功能描述**: 开始计时
- **输出**: `Timer` - 计时器实例

#### Timer.stop

- **函数名称**: `stop`
- **输入参数**: 无
- **功能描述**: 停止计时
- **输出**: `Timer` - 计时器实例

#### Timer.elapsed

- **函数名称**: `elapsed`
- **输入参数**: 无
- **功能描述**: 获取耗时（属性）
- **输出**: `float` - 耗时秒数

#### retry_on_exception

- **函数名称**: `retry_on_exception`
- **输入参数**:
  - `max_retries: int = 3` - 最大重试次数
  - `delay: float = 1.0` - 延迟时间
- **功能描述**: 重试装饰器，支持指数退避
- **输出**: 装饰器函数

### logger.py

#### setup_logger

- **函数名称**: `setup_logger`
- **输入参数**: 无
- **功能描述**: 配置日志系统，包括控制台日志、文件日志、错误日志和 RAG 专用日志
- **输出**: `logger` - 配置好的日志实例

#### get_logger

- **函数名称**: `get_logger`
- **输入参数**: `name: str = None` - 日志名称
- **功能描述**: 获取日志实例，可选择指定名称
- **输出**: `logger` - 日志实例
